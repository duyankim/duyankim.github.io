---
layout: post
author: "Yan"
catalog: true
subtitle: "HeadFirst Design Patternì„ ì½ê³ "
header-img: "img/header/none4.jpg"
title: "Gof Design Pattern - í”„ë¡ì‹œ íŒ¨í„´"
date: 2022-07-13 23:15:08 +0000
categories:
  - DesignPattern
tags:
  - ë””ìì¸íŒ¨í„´
  - Gof
  - í”„ë¡ì‹œ íŒ¨í„´
comments: true
---

# âœï¸ í”„ë¡ì‹œ íŒ¨í„´ Proxy Pattern

**í”„ë¡ì‹œ íŒ¨í„´** : íŠ¹ì • ê°ì²´ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ëŒ€ë¦¬ì¸(íŠ¹ì • ê°ì²´ë¥¼ ëŒ€ë³€í•˜ëŠ” ê°ì²´) ì œê³µ  

- í”„ë¡ì‹œ íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ ì›ê²© ê°ì²´, ìƒì„±í•˜ê¸° í˜ë“  ê°ì²´, ë³´ì•ˆì´ ì¤‘ìš”í•œ ê°ì²´ì™€ ê°™ì€ ë‹¤ë¥¸ ê°ì²´ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ëŒ€ë¦¬ì¸ ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- `ì›ê²© í”„ë¡ì‹œ`ë¥¼ ì¨ì„œ ì›ê²© ê°ì²´ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤.
- `ê°€ìƒ í”„ë¡ì‹œ`ë¥¼ ì¨ì„œ ìƒì„±í•˜ê¸° í˜ë“  ìì›ìœ¼ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤.
- `ë³´í˜¸ í”„ë¡ì‹œ`ë¥¼ ì¨ì„œ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•œ ìì›ìœ¼ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤.

![proxy pattern](https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/Proxy_pattern_diagram.svg/800px-Proxy_pattern_diagram.svg.png)
- `Subject`: `Proxy`ì™€ `RealSubject` ëª¨ë‘ `Subject`ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ ì–´ë–¤ í´ë¼ì´ì–¸íŠ¸ì—ì„œë“  í”„ë¡ì‹œë¥¼ `Subject`ì™€ ë˜‘ê°™ì€ ì‹ìœ¼ë¡œ ë‹¤ë£° ìˆ˜ ìˆë‹¤.
- `RealSubject`: ì§„ì§œ ì‘ì—…ì„ ëŒ€ë¶€ë¶„ ì²˜ë¦¬í•˜ëŠ” ê°ì²´. s
- `Proxy`: ì§„ì§œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ì˜ ë ˆí¼ëŸ°ìŠ¤ê°€ ë“¤ì–´ìˆë‹¤. `RealSubject`ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜, ê·¸ ê°ì²´ì˜ ìƒì„± ê³¼ì •ì— ê´€ì—¬í•œëŠ ê²½ìš°ê°€ ë§ë‹¤. `RealSubject`ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•œë‹¤.

## ğŸ‘½ ì›ê²© í”„ë¡ì‹œ

- ì›ê²© í”„ë¡ì‹œì˜ ì—­í•  : ì›ê²© ê°ì²´ì˜ **ë¡œì»¬ ëŒ€ë³€ì**
  - **ì›ê²© ê°ì²´** : ë‹¤ë¥¸ ì£¼ì†Œ ê³µê°„(ë‹¤ë¥¸ JVMì˜ Heapì—ì„œ ì‚´ê³  ìˆëŠ” ê°ì²´)
  - **ë¡œì»¬ ëŒ€ë³€ì** : ë¡œì»¬ ëŒ€ë³€ìì˜ ì–´ë–¤ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´, ë‹¤ë¥¸ ì›ê²© ê°ì²´ì— ê·¸ ë©”ì†Œë“œ í˜¸ì¶œì„ ì „ë‹¬í•´ ì£¼ëŠ” ê°ì²´
- í´ë¼ì´ì–¸íŠ¸ ê°ì²´ëŠ” ì›ê²© ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œì„ í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ í–‰ë™í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” **ë¡œì»¬ í™ì— ë“¤ì–´ìˆëŠ” `í”„ë¡ì‹œ`ê°ì²´ì˜ ë©”ì†Œë“œ**ë¥¼ í˜¸ì¶œí•˜ê³  ìˆë‹¤.
- ë„¤íŠ¸ì›Œí¬ í†µì‹ ê³¼ ê´€ë ¨ëœ ì €ìˆ˜ì¤€ ì‘ì—…ì€ í”„ë¡ì‹œ ê°ì²´ì—ì„œ ì²˜ë¦¬í•´ì¤€ë‹¤.

### ğŸ‘½ ì›ê²© ë©”ì†Œë“œ
![remote method](https://miro.medium.com/max/975/1*g8neQevs0ESl7swCpaNnxA.png)
- **í´ë¼ì´ì–¸íŠ¸ ê°ì²´** : ì§„ì§œ ì„œë¹„ìŠ¤ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤ê³  ìƒê°í•œë‹¤.
- **í´ë¼ì´ì–¸íŠ¸ ë³´ì¡° ê°ì²´** = proxy. ì›ê²© ê°ì²´ë¡œ ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.
- **ì„œë¹„ìŠ¤ ë³´ì¡° ê°ì²´** : Socket ì—°ê²°ë¡œ í´ë¼ì´ì–¸íŠ¸ ë³´ì¡° ê°ì²´ë¡œë¶€í„° ìš”ì²­ì„ ë°›ëŠ”ë‹¤. ë°›ì€ ìš”ì²­ì„ í•´ì„í•´ì„œ ì§„ì§œ ì„œë¹„ìŠ¤ì— ìˆëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
- **ì„œë¹„ìŠ¤ ê°ì²´** : ì‹¤ì œë¡œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë©”ì†Œë“œê°€ ë“¤ì–´ìˆë‹¤. 

## ğŸ›¸ ìë°” RMI `Remote Method Invocation`

### ğŸ›¸ RMIì˜ ê¸°ëŠ¥
- RMIëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë¹„ìŠ¤ ë³´ì¡° ê°ì²´ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
- ë³´ì¡° ê°ì²´ì—ëŠ” ì›ê²© ì„œë¹„ìŠ¤ì™€ ë˜‘ê°™ì€ ë©”ì†Œë“œê°€ ë“¤ì–´ê°„ë‹¤.
- ë„¤íŠ¸ì›Œí‚¹ ë° ì…ì¶œë ¥ ê´€ë ¨ ì½”ë“œë¥¼ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
- í´ë¼ì´ì–¸íŠ¸ëŠ” ê·¸ëƒ¥ ê°™ì€ ë¡œì»¬ JVMì— ìˆëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë“¯ì´ ì›ê²© ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

### ğŸ›¸ RMI êµ¬ì¡°
- **ìŠ¤í…**`stub`: í´ë¼ì´ì–¸íŠ¸ ë³´ì¡° ê°ì²´
- **ìŠ¤ì¼ˆë ˆí†¤**`skeleton`: ì„œë¹„ìŠ¤ ë³´ì¡° ê°ì²´
- `lookup` : í´ë¼ì´ì–¸íŠ¸ê°€ ì›ê²© ê°ì²´ë¥¼ ì°¾ì•„ì„œ ì ‘ê·¼í•  ë•Œ ì“¸ ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤
![RMI](https://t1.daumcdn.net/cfile/tistory/2704234F58ABB10B1D)

### ğŸ‘½ ì›ê²© ì„œë¹„ìŠ¤ ë§Œë“œëŠ” ë°©ë²•

#### 1. ì›ê²© ì¸í„°í˜ì´ìŠ¤ ë§Œë“¤ê¸°
í´ë¼ì´ì–¸íŠ¸ê°€ ì›ê²©ìœ¼ë¡œ í˜¸ì¶œí•  ë©”ì†Œë“œ ì •ì˜. ìŠ¤í…ê³¼ ì‹¤ì œ ì„œë¹„ìŠ¤ì— ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.  

1. `java.rmi.Remote`ë¥¼ í™•ì¥í•˜ì—¬ ì‚¬ìš©í•œë‹¤. (ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•´ì„œ ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.)
  ```java
  public interface MyRemote extends Remote
  ```
2. ëª¨ë“  ë©”ì†Œë“œê°€ `RemoteException`ì„ ë˜ì§€ë„ë¡ ì„ ì–¸í•œë‹¤. ëª¨ë“  ì›ê²© ë©”ì†Œë“œ í˜¸ì¶œì€ ìœ„í—˜ì´ ë”°ë¥´ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì˜ˆì™¸ ìƒí™© ë°œìƒì„ ëŒ€ë¹„í•œë‹¤.
3. ì›ê²© ë©”ì†Œë“œì˜ ì¸ìì™€ ë¦¬í„´ê°’ì€ ë°˜ë“œì‹œ primitive ë˜ëŠ” Serializable í˜•ì‹ìœ¼ë¡œ ì„ ì–¸í•œë‹¤.

#### 2. ì„œë¹„ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤ ë§Œë“¤ê¸°
ì‹¤ì œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” í´ë˜ìŠ¤. í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì´ ê°ì²´ì— ìˆëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œ. ì‹¤ì œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë©”ì†Œë“œê°€ êµ¬í˜„ë˜ì–´ ìˆë‹¤.  

1. ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì— ì›ê²© ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤.
  ```java
  public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
    // overideí•œ ë©”ì†Œë“œ
  }
  ```
2. `UnicastRemoteObject`ì„ í™•ì¥í•œë‹¤. ì›ê²© ì„œë¹„ìŠ¤ ê°ì²´ ì—­í• ì„ í•˜ë ¤ë©´ ì›ê²© ê°ì²´ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì•¼ ë˜ëŠ”ë°, ì´ëŠ” `java.rmi.server`ì˜ `UnicastRemoteObject`ë¥¼ í™•ì¥í•´ì„œ ìŠˆí¼í´ë˜ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
  ```java
  public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
    private static final long serialVersionUID = 1L;
    // overideí•œ ë©”ì†Œë“œ
  }
  ```
3. `RemoteException`ì„ ì„ ì–¸í•˜ëŠ” ìƒì„±ìë¥¼ êµ¬í˜„í•œë‹¤.
  ```java
  public MyRemoteImpl() throws RemoteException();
  ```
4. ì„œë¹„ìŠ¤ë¥¼ RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡í•œë‹¤. ì›ê²© ì„œë¹„ìŠ¤ë¥¼ ì›ê²© í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì“¸ ìˆ˜ ìˆê²Œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“  ë‹¤ìŒ RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ë“±ë¡í•œë‹¤.
  ```java
  try {
    MyRemote service = new MyRemoteImpl();
    Naming.rebind("RemoteHello", service);  // ì—¬ê¸°ì„œ ë“±ë¡í•œ ì´ë¦„ìœ¼ë¡œ rmiRegistryì— ê²°í•©
  } catch (Exception ex) {...}
  ```

##### ğŸ‘½ ì„œë²„ì—ì„œ ì“°ëŠ” ì½”ë“œ ìƒ˜í”Œ

###### ì›ê²© ì¸í„°í˜ì´ìŠ¤ 

```java
import java.rmi.*;

public interface MyRemote extends Remote {
  public String sayHello() throws RemoteException;
}
```

###### ì›ê²© ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤

```java
import java.rmi.*;
import java.rmi.server.*;

public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
  private static final long serialVersionUID = 1L;

  public String sayHello() {
    return "Server says, 'Hey'";
  }

  public MyRemoteImpl() throws RemoteException{ }

  public static void main (String[] args) {
    try {
      MyRemote service = new MyRemoteImpl();
      Naming.rebind("RemoteHello", service);
    } catch (Exception ex) {
      ex.printStackTrace();
    }
  }
}
```


#### 3. RMI registry ì‹¤í–‰í•˜ê¸°
ë‹¤ë¥¸ í„°ë¯¸ë©€ ì°½ì—ì„œ `%rmiregistry`ì‹¤í–‰í•œë‹¤. ì´ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œë¶€í„° í”„ë¡ì‹œ(ìŠ¤í…, í´ë¼ì´ì–¸íŠ¸ ë³´ì¡° ê°ì²´)ë¥¼ ë°›ì•„ê°„ë‹¤.  

#### 4. ì›ê²© ì„œë¹„ìŠ¤ ì‹¤í–‰í•˜ê¸°
ë‹¤ë¥¸ í„°ë¯¸ë„ì„ ì—´ê³  ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ ì‹¤í–‰í•´ì•¼ í•œë‹¤. ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì—ì„œ ì„œë¹„ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  ê·¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡í•œë‹¤. ìŠ¤í…ê³¼ ìŠ¤ì¼ˆë ˆí†¤ì€ ë³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œ ë™ì ìœ¼ë¡œ ë§Œë“ ë‹¤.

#### ğŸ‘½ ìŠ¤í… ê°ì²´ë¥¼ ë£©ì—…í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸

ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ë¦¬í„´ëœ ê°ì²´ëŠ” Object í˜•ì‹ì´ë‹ˆê¹Œ ë°˜ë“œì‹œ ìºìŠ¤íŒ…ì„ í•´ì•¼í•œë‹¤.

1. í´ë¼ì´ì–¸íŠ¸ì—ì„œ RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë£©ì—…
  ```java
  MyRemote service = (MyRemote) Naming.lookup("rmi://127.0.0.1/RemoteHello");
  ```
2. RMI ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ìŠ¤í… ê°ì²´ë¥¼ ë¦¬í„´. ìŠ¤í… ê°ì²´ëŠ” ìë™ìœ¼ë¡œ ì—­ì§ˆë ¬í™”ë˜ì–´ì„œ ì „ë‹¬ë¨. ì´ë•Œ ìŠ¤í… í´ë˜ìŠ¤ëŠ” ë°˜ë“œì‹œ í´ë¼ì´ì–¸íŠ¸ì—ë§Œ ìˆì–´ì•¼ í•œë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ìŠ¤í…ì˜ ì„œë¹„ìŠ¤ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. ìŠ¤í…ì´ ì§„ì§œ ì„œë¹„ìŠ¤ ê°ì²´ë¼ê³  ìƒê°í•œë‹¤.

###### í´ë¼ì´ì–¸íŠ¸ ìƒ˜í”Œ

```java
import java.rmi.*;

public class MyRemoteClient {
  
  public static void main (Sring[] args) {
    new MyRemoteClient().go();
  }

  public void go() {

    try {
      MyRemote service = (MyRemote) Naming.lookup("rmi://127.0.0.1/RemoteHello");
      String s = servcie.sayHello();
      System.out.println(s);
    } catch (Exception ex) {
      ex.printStackTrace();
    }
  }
}
```

## ğŸ›° ê°€ìƒ í”„ë¡ì‹œ

- ìƒì„±í•˜ëŠ” ë° ë§ì€ ë¹„ìš©ì´ ë“œëŠ” ê°ì²´ë¥¼ ëŒ€ì‹ í•œë‹¤.
- ì§„ì§œ ê°ì²´ê°€ í•„ìš”í•œ ìƒí™©ì´ ì˜¤ê¸° ì „ê¹Œì§€ ê°ì²´ì˜ ìƒì„±ì„ ë¯¸ë£¨ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- ê°ì²´ ìƒì„±ì´ ëë‚˜ë©´ `RealSubject`ì— ì§ì ‘ ìš”ì²­ì„ ì „ë‹¬í•œë‹¤.

## ğŸª ë³´í˜¸ í”„ë¡ì‹œ

- **ë™ì  í”„ë¡ì‹œ** : `java.lang.reflect`ì˜ í”„ë¡ì‹œ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ ì¦‰ì„ì—ì„œ í•˜ë‚˜ ì´ìƒì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ , ì§€ì •í•œ í´ë˜ìŠ¤ì— ë©”ì†Œë“œ í˜¸ì¶œì„ ì „ë‹¬í•˜ëŠ” í”„ë¡ì‹œ í´ë˜ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì— ìƒì„±ë˜ëŠ” ê²ƒ
- **ë³´í˜¸ í”„ë¡ì‹œ** : ì ‘ê·¼ ê¶Œí•œì„ ë°”íƒ•ìœ¼ë¡œ ê°ì²´ë¡œì˜ ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” í”„ë¡ì‹œ
  - `InvocationHandler`ì— í”„ë¡ì‹œ í´ë˜ìŠ¤ì— ë„£ì„ ìˆ˜ ì—†ëŠ” *Proxy í´ë˜ìŠ¤ì—ê²Œ ë¬´ìŠ¨ ì¼ì„ í•´ì•¼ í•˜ëŠ”ì§€ ì•Œë ¤ ì¤„ ë°©ë²•*ì„ ë„£ëŠ”ë‹¤.
  - `InvocationHandler`ëŠ” í”„ë¡ì‹œì— í˜¸ì¶œë˜ëŠ” ëª¨ë“  ë©”ì†Œë“œì— ì‘ë‹µí•œë‹¤. 
  - Proxyì—ì„œ ë©”ì†Œë“œ í˜¸ì¶œì„ ë°›ëŠ”ë‹¤ â†’ `InvocationHandler`ì— ì§„ì§œ ì‘ì—…ì„ ë¶€íƒí•œë‹¤.
![ë³´í˜¸í”„ë¡ì‹œ](https://t1.daumcdn.net/cfile/tistory/266EE435543B43B112)

### ë™ì  í”„ë¡ì‹œ ë§Œë“œëŠ” ë°©ë²•

#### 1. InvocationHandler ë§Œë“¤ê¸°
InvocationHandlerëŠ” í”„ë¡ì‹œì˜ í–‰ë™ì„ êµ¬í˜„í•œë‹¤.

#### 2. ë™ì  í”„ë¡ì‹œ ìƒì„± ì½”ë“œ ë§Œë“¤ê¸°
í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ê·¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ì½”ë“œë¥¼ ì“´ë‹¤.

#### 3. ì ì ˆí•œ í”„ë¡ì‹œë¡œ ê°ì²´ ê°ì‹¸ê¸°

###### reference

> HeadFirst Design Pattern   