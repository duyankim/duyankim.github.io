---
layout: post
author: "Yan"
catalog: true
subtitle: "Elasticsearchë€? RDBì™€ ë¹„êµë¥¼ ê³ë“¤ì¸"
header-img: "img/header/sql.jpg"
title: "Elasticsearch vs RDB"
date: 2025-04-13 11:40:08 +0000
categories:
  - SQL
tags:
  - SQL
  - DB
  - RDB
  - Elasticsearch
comments: true
---

# [Elasticsearch](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro-what-is-es.html)

- Java ì˜¤í”ˆì†ŒìŠ¤ ë¶„ì‚° ê²€ìƒ‰ ì—”ì§„
- ë°©ëŒ€í•œ ì–‘ì˜ ë°ì´í„°ë¥¼ ì‹ ì†í•˜ê²Œ, ê±°ì˜ ì‹¤ì‹œê°„( NRT, Near Real Time )ìœ¼ë¡œ ì €ì¥, ê²€ìƒ‰, ë¶„ì„í•  ìˆ˜ ìˆë‹¤.
- ESëŠ” ì—­ìƒ‰ì¸ì„ ì§€ì›í•˜ê¸°ì— ê¸°ì¡´ RDBê°€ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¹„ì •í˜• ë°ì´í„°ë¥¼ ì¸ë±ì‹± + ê²€ìƒ‰í•˜ëŠ” ê²ƒì— íŠ¹í™”ë˜ì–´ìˆë‹¤.
  - ë¹„ì •í˜• ë°ì´í„°: ê·œì¹™ì´ ì—†ëŠ” ë°ì´í„°. ex) ìŒì„±, í…ìŠ¤íŠ¸, ì˜ìƒ
  - ì—­ìƒ‰ì¸ : í‚¤ì›Œë“œë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì°¾ëŠ” ë°©ì‹
- ê²€ìƒ‰ì„ ìœ„í•´ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©ë˜ê¸°ë„ í•˜ë©°, ELK( Elasticsearch / Logstatsh / Kibana )ìŠ¤íƒìœ¼ë¡œ ì‚¬ìš©ë˜ê¸°ë„ í•œë‹¤.

### ELK

- **Logstash** : ë‹¤ì–‘í•œ ì†ŒìŠ¤( DB, csvíŒŒì¼ ë“± )ì˜ ë¡œê·¸ ë˜ëŠ” íŠ¸ëœì­ì…˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘, ì§‘ê³„, íŒŒì‹±í•˜ì—¬ Elasticsearchë¡œ ì „ë‹¬
- **Elasticsearch**: Logstashë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ê²€ìƒ‰ ë° ì§‘ê³„ë¥¼ í•˜ì—¬ í•„ìš”í•œ ê´€ì‹¬ ìˆëŠ” ì •ë³´ë¥¼ íšë“
- **Kibana** : Elasticsearchì˜ ë¹ ë¥¸ ê²€ìƒ‰ì„ í†µí•´ ë°ì´í„°ë¥¼ ì‹œê°í™” ë° ëª¨ë‹ˆí„°ë§

## RDBì™€ ë¹„êµ

- RDBì˜ ê²½ìš° ëª¨ë“  rowë¥¼ ì½ì–´ì„œ ìŠ¤í˜ì´ìŠ¤ë¥¼ ë”œë¦¬ë¯¸í„°ë¡œ íŒŒì‹±í•œ ë’¤, í™ê¸¸ë™ í¬í•¨ì—¬ë¶€ë¥¼ ì¡°ì‚¬í•´ì•¼í•œë‹¤. ë”°ë¼ì„œ ëª¨ë“  rowë¥¼ ì½ì–´ì•¼ë§Œ í•˜ê¸°ì— ìƒë‹¹í•œ ê²€ìƒ‰ì‹œê°„ì´ ì†Œìš”ëœë‹¤.
- ë°˜ë©´ ESëŠ” ì €ì¥í•  ë•Œë¶€í„° í† í°í™”í•˜ì—¬ ì—­ìƒ‰ì¸ ì¸ë±ìŠ¤ì— (id, ë‹¨ì–´, doc_id) í˜•íƒœë¡œ ì €ì¥í•œë‹¤. ë”°ë¼ì„œ íŠ¹ì • rowë§Œ ì½ê³  ê²€ìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤. ë‹¨ì–´ë¥¼ í¬í•¨í•˜ëŠ” doc_id ë¥¼ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆìœ¼ë©° ë¹ ë¥¸ ê²€ìƒ‰ì´ ê°€ëŠ¥í•˜ë‹¤.

## Elasticsearch ì‚¬ìš© ë°©ì‹

### ë°ì´í„° ë„£ê¸° (Indexing)

- ESì—ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë‹¨ìœ„ë¥¼ **"ë¬¸ì„œ(Document)"**ë¼ê³  ë¶€ë¥´ê³ , ì´ ë¬¸ì„œëŠ” JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥
- ë‚´ë¶€ì ìœ¼ë¡œ **ì—­ìƒ‰ì¸(inverted index)** êµ¬ì¡°ë¥¼ ì‚¬ìš©í•´ í…ìŠ¤íŠ¸ ê¸°ë°˜ ê²€ìƒ‰ì„ ìµœì í™”ëœ ë°©ì‹ìœ¼ë¡œ ì €ì¥

```json
POST /products/_doc/1
{
  "name": "MacBook Pro",
  "price": 2999,
  "category": "laptop",
  "description": "Apple laptop with M2 chip"
}
```
- products: ì¸ë±ìŠ¤ ì´ë¦„ (RDBì˜ í…Œì´ë¸” ì—­í• )
- _doc: íƒ€ì… (ES 7.x ì´í›„ ê±°ì˜ ê³ ì •ë¨)
- 1: ë¬¸ì„œ ID (ì—†ìœ¼ë©´ ESê°€ ìë™ ìƒì„±)
- ë³¸ë¬¸: JSON ë°ì´í„°

### ê²€ìƒ‰í•˜ê¸° (Querying)

ê²€ìƒ‰ ì‹œì—ëŠ” SQLì´ ì•„ë‹Œ **ES DSL(Domain Specific Language)**ì´ë¼ëŠ” JSON ê¸°ë°˜ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©  

ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ (Full-text Search) ì˜ˆ:  

```json
GET /products/_search
{
  "query": {
    "match": {
      "description": "apple laptop"
    }
  }
}
```

ì¡°ê±´ ê²€ìƒ‰ (Filtering) ì˜ˆ:  

```json
GET /products/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "category": "laptop" } }
      ],
      "filter": [
        { "range": { "price": { "lt": 3000 } } }
      ]
    }
  }
}
```

- `match`ëŠ” ë¶„ì„ê¸°(analyzer)ë¥¼ ê±°ì³ ìì—°ì–´ ì²˜ë¦¬ ê¸°ë°˜ ê²€ìƒ‰ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- `filter`ëŠ” ë¶„ì„ ì—†ì´ ì¡°ê±´ ë§¤ì¹­ë§Œ ìˆ˜í–‰í•˜ë¯€ë¡œ ìºì‹±ì´ ê°€ëŠ¥í•˜ê³  ë¹ ë¥´ë‹¤.
  - Analyzer: ë¬¸ì¥ì„ ìª¼ê°œê³ (lowercase, stemming ë“±) ì¸ë±ì‹±í•  ë•Œ ì“°ëŠ” ë„êµ¬


## RDBì™€ ë¹„êµ

## âœ… ES vs RDB ë¹„êµ

| êµ¬ë¶„ | RDB (ì˜ˆ: MySQL, Oracle) | ElasticSearch |
|------|-------------------------|----------------|
| **ëª©ì ** | ë°ì´í„°ì˜ ì •í•©ì„± & íŠ¸ëœì­ì…˜ ì¤‘ì‹¬ ì €ì¥ | ë¹ ë¥´ê³  ìœ ì—°í•œ **ê²€ìƒ‰ê³¼ ì§‘ê³„** |
| **ë°ì´í„° êµ¬ì¡°** | í…Œì´ë¸” - í–‰(row), ì—´(column) ê¸°ë°˜ | ì¸ë±ìŠ¤ - ë¬¸ì„œ(document, JSON ê¸°ë°˜) |
| **ìŠ¤í‚¤ë§ˆ** | ì—„ê²©í•œ ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ (DDL) | ìŠ¤í‚¤ë§ˆë¦¬ìŠ¤, ìœ ì—°í•œ ë§¤í•‘ (ìë™ ì¶”ë¡  ê°€ëŠ¥) |
| **ì§ˆì˜ ì–¸ì–´** | SQL | DSL (JSON ê¸°ë°˜ ë„ë©”ì¸ ì¿¼ë¦¬) |
| **ê²€ìƒ‰ ê¸°ëŠ¥** | ì •í™•í•œ ê°’ ë¹„êµ ì¤‘ì‹¬ (LIKE í¬í•¨) | ìì—°ì–´ ê¸°ë°˜ **Full-Text Search**, ì •ê·œí™”ëœ ìƒ‰ì¸ ê¸°ë°˜ |
| **ì¸ë±ì‹± êµ¬ì¡°** | B-Tree ê¸°ë°˜ (ì£¼ë¡œ PK, FK ì¸ë±ìŠ¤) | Inverted Index (ì—­ìƒ‰ì¸, í…ìŠ¤íŠ¸ ê²€ìƒ‰ ìµœì í™”) |
| **ì„±ëŠ¥** | ìˆ˜ì§ì  í™•ì¥ (Scale-up ìœ„ì£¼) | ìˆ˜í‰ì  í™•ì¥ (Scale-out, ìƒ¤ë”©/ë ˆí”Œë¦¬ì¹´) |
| **ì •í•©ì„±** | ACID ì§€ì› (íŠ¸ëœì­ì…˜ ê°•í•¨) | ê¸°ë³¸ì€ Eventually Consistent (ìµœì¢… ì¼ê´€ì„±) |
| **ì‚¬ìš© ì˜ˆ** | ê¸ˆìœµ íŠ¸ëœì­ì…˜, ERP, OLTP | ê²€ìƒ‰ì—”ì§„, ë¡œê·¸ ë¶„ì„, ëŒ€ì‹œë³´ë“œ, ì¶”ì²œ |

---

### âœ… ì£¼ìš” ì°¨ì´ì 

#### 1. ğŸ” **ê²€ìƒ‰ ë°©ì‹**
- RDBëŠ” `LIKE`, `=`, `IN`, `BETWEEN` ê°™ì€ ì •í™•í•œ ì¡°ê±´ ê²€ìƒ‰ ìœ„ì£¼
  - ì˜ˆ: `WHERE title LIKE '%laptop%'`
- ESëŠ” **match, full-text search, fuzzy, n-gram, autocomplete ë“±** ë‹¤ì–‘í•œ ê²€ìƒ‰ì´ ìì—°ì–´ ê¸°ë°˜ìœ¼ë¡œ ì§€ì›ë©ë‹ˆë‹¤.
  - ì˜ˆ: "ì• í”Œ ë©íƒ‘" â†’ "apple laptop"ì„ ìë™ ë§¤ì¹­

#### 2. âš™ï¸ **ì¸ë±ì‹± êµ¬ì¡°**
- RDB: B-Tree ì¸ë±ìŠ¤ëŠ” "ì •ë ¬/ë²”ìœ„ ê¸°ë°˜ íƒìƒ‰"ì— íŠ¹í™”ë¨
- ES: Inverted IndexëŠ” "ë‹¨ì–´ â†’ ë¬¸ì„œ ID ë¦¬ìŠ¤íŠ¸"ë¥¼ ë¯¸ë¦¬ ì €ì¥í•´ë†“ê³  **ê²€ìƒ‰ ìµœì í™”ì— íƒì›”**

#### 3. ğŸ’¾ **ë°ì´í„° ì €ì¥ê³¼ ì •í•©ì„±**
- RDBëŠ” `BEGIN`, `COMMIT`, `ROLLBACK` ë“± **íŠ¸ëœì­ì…˜ ì²˜ë¦¬**ë¡œ ì •í•©ì„± ë³´ì¥
- ESëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì´ ì—†ìœ¼ë©°, **ë¶„ì‚° êµ¬ì¡°ì—ì„œ ì¼ê´€ì„±ì€ eventual consistency**

#### 4. ğŸ§  **ëª¨ë¸ë§ ì² í•™**
- RDBëŠ” **ì •ê·œí™”** ì¤‘ì‹¬ (ê´€ê³„ë¡œ ë°ì´í„° ë¶„ë¦¬, Joinìœ¼ë¡œ ê²°í•©)
- ESëŠ” **ë¹„ì •ê·œí™”** ì¤‘ì‹¬ (Joinì´ ì—†ê±°ë‚˜ ì œí•œì  â†’ í•„ìš”í•œ ëª¨ë“  í•„ë“œë¥¼ í•œ ë¬¸ì„œì— ë„£ëŠ” ë°©ì‹)

---

### âœ… RDBì˜ Joinê³¼ ë¹„êµí•´ë³´ë©´

ElasticSearchëŠ” **ì „í†µì ì¸ RDBì˜ Join ê¸°ëŠ¥ì´ ë§¤ìš° ì œí•œì **ì´ë¼ì„œ, ë³´í†µì€ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ìš°íšŒí•˜ê±°ë‚˜ ë°ì´í„° ëª¨ë¸ë§ ìì²´ë¥¼ ë°”ê¾¸ëŠ” ê²½ìš°ê°€ ë§ë‹¤ê³  í•œë‹¤.

| êµ¬ë¶„ | RDB | ElasticSearch |
|------|-----|----------------|
| **Join ë°©ì‹** | INNER, LEFT, RIGHT, OUTER ë“± ììœ ë¡œìš´ ì¡°ì¸ | Join ìì²´ê°€ ì—†ìŒ (ì œí•œëœ nested, parent-childë§Œ ì§€ì›) |
| **ê´€ê³„ ì„¤ì •** | ì™¸ë˜í‚¤ ê¸°ë°˜ ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ë‹¤ ê´€ê³„ ëª…í™• | ëŒ€ë¶€ë¶„ ë¹„ì •ê·œí™”í•˜ê±°ë‚˜, nested/parent-child êµ¬ì¡°ë¡œ ìš°íšŒ |
| **ì„±ëŠ¥ ì˜í–¥** | Join ë§ì•„ì§€ë©´ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ | Join ìì²´ê°€ ì—†ìœ¼ë¯€ë¡œ ê²€ìƒ‰ì— ìµœì í™”ë¨ |

---

#### âœ… ESì—ì„œ Joinì„ ëŒ€ì²´í•˜ëŠ” 3ê°€ì§€ ë°©ë²•

##### 1. **ë°ì´í„° ë¹„ì •ê·œí™” (Denormalization)** âœ… ê°€ì¥ ì¼ë°˜ì 
---

###### ì˜ˆì‹œ ìƒí™©:
- `user` í…Œì´ë¸” (id, name)
- `order` í…Œì´ë¸” (id, user_id, amount)

â†’ ESì—ì„œëŠ” **order ë¬¸ì„œì— user ì •ë³´ê¹Œì§€ í†µì§¸ë¡œ í¬í•¨**í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°

```json
{
  "order_id": 123,
  "user_id": 1,
  "user_name": "í—¤ë°ì›¨ì´",
  "amount": 10000
}
```

ğŸ“Œ ì¥ì : ê²€ìƒ‰ ì†ë„ ë§¤ìš° ë¹ ë¦„  
ğŸ“Œ ë‹¨ì : user nameì´ ë°”ë€Œë©´ ê´€ë ¨ëœ ëª¨ë“  order ë¬¸ì„œë¥¼ ê°±ì‹ í•´ì•¼ í•¨ (ì¤‘ë³µ ë°ì´í„° ê´€ë¦¬ í•„ìš”)

---

##### 2. **Nested íƒ€ì…** (JSON ë°°ì—´ ë‚´ë¶€ì— ë¬¸ì„œ í˜•íƒœë¡œ ì €ì¥)
---

###### ì˜ˆì‹œ ìƒí™©:
- ìƒí’ˆ(product)ì— ë¦¬ë·°ê°€ ì—¬ëŸ¬ ê°œ ë¶™ëŠ” êµ¬ì¡° (1:N)

```json
{
  "product_name": "ë…¸íŠ¸ë¶",
  "reviews": [
    { "author": "ê°œì¸ ë¹„", "score": 5 },
    { "author": "ê³¨ë“œë¬¸íŠ¸", "score": 4 }
  ]
}
```

ğŸ“Œ íŠ¹ì§•:
- `nested` íƒ€ì…ìœ¼ë¡œ ì„ ì–¸í•´ì•¼ í•¨
- `nested query`ë¥¼ ì‚¬ìš©í•´ ë‚´ë¶€ í•„ë“œ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥

#### ì¿¼ë¦¬ ì˜ˆì‹œ:
```json
{
  "query": {
    "nested": {
      "path": "reviews",
      "query": {
        "bool": {
          "must": [
            { "match": { "reviews.author": "ê°œì¸ ë¹„" } },
            { "match": { "reviews.score": 5 } }
          ]
        }
      }
    }
  }
}
```

ğŸ“Œ ì¼ë°˜ queryë¡œ í•˜ë©´ `"ê°œì¸ ë¹„"`ì™€ `"5"`ê°€ ì„œë¡œ ë‹¤ë¥¸ ë¦¬ë·° ê°ì²´ì—ì„œ ë‚˜ì™€ë„ ë§¤ì¹­ë  ìˆ˜ ìˆì–´ì„œ nestedê°€ í•„ìš”í•¨


###### Refernce

> [[Elasticsearch] ê¸°ë³¸ ê°œë…ì¡ê¸°](https://victorydntmd.tistory.com/308)
