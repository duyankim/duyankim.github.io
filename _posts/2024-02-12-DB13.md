---
layout: post
author: "Yan"
catalog: true
subtitle: "SQL BOOSTERë¥¼ ì½ê³ "
header-img: "img/header/sql.jpg"
title: "Oracle - GROUP BY, ROLL UP"
date: 2024-02-12 11:40:08 +0000
categories:
  - SQL
tags:
  - SQL
  - DB
  - GROUP BY
  - ROLL UP
comments: true
---

> SQL ìŠ¤í„°ë”” 1ì£¼ì°¨ ì‹œìž‘!

# ðŸ–‡ GROUP BY

- ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•˜ëŠ” ë¬¸ë²•. ê°™ì€ ê°’ì„ ê°€ì§„ ë°ì´í„°ë¼ë¦¬ ëª¨ìœ¼ëŠ” ê²ƒ.
- ì¤‘ë³µëœ ê°’ì´ ì œê±°ë˜ì–´ ê²°ê³¼ë¡œ ë‚˜ì˜¬ ìˆ˜ ìžˆë„ë¡ í•œë‹¤ = `DISTINCT`ì˜ ì—­í• ê³¼ ê°™ë‹¤.
  - `DISTINCT` ì™€ ë‹¤ë¥¸ ì : SUM, MIN ê°™ì€ ì§‘ê³„í•¨ìˆ˜ë¥¼ ì“¸ ìˆ˜ ìžˆë‹¤.
- TO_CHAR, TO_DATEê°™ì€ ê¸°ë³¸ í•¨ìˆ˜ì™€ CASEë¬¸ ê°™ì€ ë¬¸ë²•ì„ ì“¸ ìˆ˜ ìžˆë‹¤.
- ë¬¸ë²• : `WHERE ì ˆ`ê³¼ `ORDER BY ì ˆ` ì‚¬ì´ì— ì“´ë‹¤. `SELECT ì ˆ`ì—ëŠ” `GROUP BY`ì— ì‚¬ìš©í•  ì»¬ëŸ¼ì„ ë˜‘ê°™ì´ ì¨ì¤€ë‹¤.

## ì£¼ìš” ì§‘ê³„í•¨ìˆ˜
1. **SUM** : ìˆ˜ëŸ‰, ê¸ˆì•¡ê³¼ ê°™ì€ ìˆ«ìží˜• ë°ì´í„°ì˜ í•©
2. **COUNT** : ë°ì´í„°ì˜ ê±´ìˆ˜
3. **MIN** : ë°ì´í„°ì˜ ìµœì†Ÿê°’
4. **MAX** : ë°ì´í„°ì˜ ìµœëŒ“ê°’

- ì§‘ê³„í•¨ìˆ˜ëŠ” `GROUP BY`ê°€ ì—†ì–´ë„ ë‹¨ë… ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
- ì§‘ê³„í•¨ìˆ˜ ê´„í˜¸ ì•ˆì—ì„œë„ `CASEë¬¸`ì„ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
- ì§‘ê³„í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì»¬ëŸ¼ì€ `SELECTì ˆ`ì—ì„œ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

```SQL
	-- ì§‘ê³„í•¨ìˆ˜ - ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” SQL
	SELECT  T1.ORD_ST -- ì§‘ê³„í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì»¬ëŸ¼
		,COUNT(*) CNT
		,SUM(T1.ORD_AMT) TTL_ORD_AMT
		,MIN(T1.ORD_SEQ) MIN_ORD_SEQ
  	,MAX(T1.ORD_SEQ) MAX_ORD_SEQ
	FROM    T_ORD T1
	WHERE T1.ORD_DT>= TO_DATE('20170101','YYYYMMDD')
	AND T1.ORD_DT < TO_DATE('20170201','YYYYMMDD');

	-- ì§‘ê³„í•¨ìˆ˜ - ì •ìƒì ì¸ SQL
	SELECT  COUNT(*) CNT
		,SUM(T1.ORD_AMT) TTL_ORD_AMT
		,MIN(T1.ORD_SEQ) MIN_ORD_SEQ
		,MAX(T1.ORD_SEQ) MAX_ORD_SEQ
	FROM    T_ORD T1
	WHERE T1.ORD_DT >= TO_DATE('20170101','YYYYMMDD')
	AND T1.ORD_DT < TO_DATE('20170201','YYYYMMDD');
  ```

### COUNT ì§‘ê³„ í•¨ìˆ˜ ì‚¬ìš©ì‹œ ì£¼ì˜ì 

#### NULLì„ ì§‘ê³„í•˜ëŠ”ì§€?
- COUNTëŠ” NULL ê°’ì„ 0ìœ¼ë¡œ ì¹´ìš´íŠ¸í•œë‹¤.
- ê·¸ëŸ¬ë‚˜, COUNT(*)ì€ ë¡œìš° ìžì²´ë¥¼ ê±´ìˆ˜ë¡œ ì¹´ìš´íŠ¸í•˜ì—¬ ë¡œìš°ë¥¼ êµ¬ì„±í•˜ëŠ” ì»¬ëŸ¼ì´ ëª¨ë‘ NULLì´ì–´ë„ 1ë¡œ ì¹´ìš´íŠ¸í•œë‹¤.

#### ì¤‘ë³µì„ ì œê±°í•˜ë ¤ë©´?
- COUNT(DISTINCT ì»¬ëŸ¼ëª…)ìœ¼ë¡œ ì¤‘ë³µì„ ì œê±°í•  ìˆ˜ ìžˆë‹¤.
- **í•œë²ˆì´ë¼ë„** ~~í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ë•Œ ìœ ìš©í•˜ë‹¤.

```SQL
	-- ì£¼ë¬¸ë…„ì›”ë³„ ì£¼ë¬¸ê³ ê° ìˆ˜(ì¤‘ë³µì„ ì œê±°í•´ì„œ ì¹´ìš´íŠ¸), ì£¼ë¬¸ê±´ìˆ˜
	SELECT  TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM
		  ,COUNT(DISTINCT T1.CUS_ID) CUS_CNT
		  ,COUNT(*) ORD_CNT
	FROM    T_ORD T1
	WHERE   T1.ORD_DT >= TO_DATE('20170101','YYYYMMDD')
	AND     T1.ORD_DT < TO_DATE('20170401','YYYYMMDD')
	GROUP BY TO_CHAR(T1.ORD_DT,'YYYYMM')
	ORDER BY TO_CHAR(T1.ORD_DT,'YYYYMM');
```

- `COUNT(DISTINCT)`ëŠ” ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. 2ê°œ ì»¬ëŸ¼ ì‚¬ìš©ì‹œ `||`ë¡œ ê²°í•©í•´ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

  ```SQL
  --USE CONCAT
	SELECT  COUNT(DISTINCT T1.ORD_ST||'-'||T1.PAY_TP)
	FROM    T_ORD T1;
  ```

##### SELECT ~ EXISTSë¡œ ëŒ€ì‹ í•˜ê¸°

`DISTINCT`ê°€ ì•„ë‹Œ `EXISTS`ë¡œ êµ¬í˜„í•  ìˆ˜ë„ ìžˆë‹¤.  

### HAVING
- `GROUP BY`ê°€ ìˆ˜í–‰ëœ ê²°ê³¼ ì§‘í•©ì— ì¡°ê±´ì„ ì¤„ ë•Œ ì‚¬ìš©
- WHERE ì ˆê³¼ ê°™ì€ ê¸°ëŠ¥
- ë¬¸ë²• : `GROUP BY`ë’¤ì— ìœ„ì¹˜. `ORDER BY` ì•žì— ìœ„ì¹˜. `AND`, `OR` ì‚¬ìš© ê°€ëŠ¥
- `GROUP BY`ì— ì •ì˜í•œ ì»¬ëŸ¼ì€ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìžˆìœ¼ë‚˜, `GROUP BY`ì— ì •ì˜í•˜ì§€ ì•Šì€ ë‚´ìš©ì€ ì§‘ê³„í•¨ìˆ˜ ì²˜ë¦¬ í›„ì— ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì¸ë¼ì¸-ë·°ì— ëŒ€í•œ WHEREì ˆë¡œ ëŒ€ì‹ í•˜ëŠ” ë°©ë²•: `GROUP BY`ê²°ê³¼ë¥¼ ì¸ë¼ì¸-ë·°ë¡œ ì²˜ë¦¬, ì¸ë¼ì¸-ë·° ë°”ê¹¥ì—ì„œ WHEREì ˆë¡œ ì²˜ë¦¬


### ðŸ“GROUP BY ê´€ë ¨ ê¸°ì–µí•  ê²ƒë“¤
1. `GROUP BY`ì— ì‚¬ìš©í•œ ì»¬ëŸ¼ë§Œ SELECT ì ˆì—ì„œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
2. `GROUP BY`ì— ì‚¬ìš©í•˜ì§€ ì•Šì€ ì»¬ëŸ¼ì€ SELECT ì ˆì—ì„œ ì§‘ê³„í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
3. HAVING ì‚¬ìš©ì‹œ `GROUP BY`ì— ì •ì˜í•œ ì»¬ëŸ¼ì€ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìžˆìœ¼ë‚˜, `GROUP BY`ì— ì •ì˜í•˜ì§€ ì•Šì€ ë‚´ìš©ì€ ì§‘ê³„í•¨ìˆ˜ ì²˜ë¦¬ í›„ì— ì‚¬ìš©í•´ì•¼ í•œë‹¤.

# ðŸ–‡ ROLLUP

- ì†Œê³„ì™€ ì „ì²´í•©ê³„ê°€ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©
- ë¬¸ë²• : `GROUP BY`ë’¤ì— ROLL UPì´ë¼ê³  ì ì–´ì„œ ì‚¬ìš©
  - ì˜ˆì‹œ : **GROUP BY ROLL UP(A,B,C,D)**
    - GROUP BYëœ A+B+C+Dë³„ ë°ì´í„°
    - A+B+Cë³„ ì†Œê³„ ë°ì´í„°
    - A+Bë³„ ì†Œê³„ ë°ì´í„°
    - Aë³„ ì†Œê³„ ë°ì´í„°
    - ì „ì²´í•©ê³„

```SQL
	-- GROUP BY
	SELECT  TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM 
			,T1.CUS_ID
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
	WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
	AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
	GROUP BY TO_CHAR(T1.ORD_DT,'YYYYMM') ,T1.CUS_ID
	ORDER BY TO_CHAR(T1.ORD_DT,'YYYYMM') ,T1.CUS_ID;

  -- GROUP BY~ROLLUP
	SELECT TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM 
			,T1.CUS_ID
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
	WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
	AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
	GROUP BY 
	ROLLUP(TO_CHAR(T1.ORD_DT,'YYYYMM') ,T1.CUS_ID)
	ORDER BY TO_CHAR(T1.ORD_DT,'YYYYMM') ,T1.CUS_ID;
```

### ROLL UP ì£¼ì˜ì‚¬í•­ : ì»¬ëŸ¼ ìˆœì„œ

- ì»¬ëŸ¼ ìˆœì„œì— ë”°ë¼ ë‹¤ë¥¸ ì†Œê³„ê°€ ë‚˜ì˜¨ë‹¤. ì»¬ëŸ¼ ìˆœì„œëŒ€ë¡œ ê³„ì¸µì  ì†Œê³„ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸.

  - ì˜ˆì‹œ1 : GROUP BY ROLL UP(A,B,C,D)
    - GROUP BYëœ A+B+C+Dë³„ ë°ì´í„°
    - A+B+Cë³„ ì†Œê³„ ë°ì´í„°
    - A+Bë³„ ì†Œê³„ ë°ì´í„°
    - Aë³„ ì†Œê³„ ë°ì´í„°
    - ì „ì²´í•©ê³„

  - ì˜ˆì‹œ2 : GROUP BY ROLL UP(B,A,C,D)
    - GROUP BYëœ B+A+C+Dë³„ ë°ì´í„°
    - B+A+Cë³„ ì†Œê³„ ë°ì´í„°
    - B+Aë³„ ì†Œê³„ ë°ì´í„°
    - Bë³„ ì†Œê³„ ë°ì´í„°
    - ì „ì²´í•©ê³„

#### íŠ¹ì • ë¶€ë¶„ ì†Œê³„ë§Œ êµ¬í•˜ê³  ì‹¶ì„ ë•Œ

`ROLLUP`ì˜ ìœ„ì¹˜ë¥¼ ì˜®ê¸°ê±°ë‚˜ ì†Œê³„ê°€ í•„ìš”í•œ ëŒ€ìƒì„ ê´„í˜¸ë¡œ ì¡°ì •í•œë‹¤.

#### ì»¬ëŸ¼ ë¬¶ê¸°

- ì—¬ëŸ¬ ì»¬ëŸ¼ì„ í•˜ë‚˜ì˜ ê´„í˜¸ë¡œ ë¬¶ì„ ìˆ˜ ìžˆë‹¤.
- ì „ì²´í•©ê³„ì™€ ì¼ë¶€ ì»¬ëŸ¼ë§Œ ì†Œê³„ë¥¼ ë‚´ì•¼í•  ë•Œ ìœ ìš©í•˜ë‹¤.

```SQL
	-- ì£¼ë¬¸ë…„ì›”, ì§€ì—­ID, ê³ ê°ë“±ê¸‰ë³„ ì£¼ë¬¸ê¸ˆì•¡ â€“ ì „ì²´ í•©ê³„ë§Œ êµ¬í•˜ê¸°
	SELECT  CASE  WHEN GROUPING(TO_CHAR(T2.ORD_DT,'YYYYMM'))=1 THEN 'Total' 
				  ELSE TO_CHAR(T2.ORD_DT,'YYYYMM') END ORD_YM 
			,CASE WHEN GROUPING(T1.RGN_ID) = 1 THEN 'Total' ELSE T1.RGN_ID END RGN_ID
			,CASE WHEN GROUPING(T1.CUS_GD) = 1 THEN 'Total' ELSE T1.CUS_GD END CUS_GD
			,SUM(T2.ORD_AMT) ORD_AMT
	FROM    M_CUS T1
			,T_ORD T2
	WHERE   T1.CUS_ID = T2.CUS_ID
	AND     T2.ORD_DT >= TO_DATE('20170201','YYYYMMDD')
	AND     T2.ORD_DT < TO_DATE('20170401','YYYYMMDD')
	AND     T1.RGN_ID IN ('A','B')
	GROUP BY ROLLUP((TO_CHAR(T2.ORD_DT,'YYYYMM') ,T1.RGN_ID ,T1.CUS_GD))
	ORDER BY TO_CHAR(T2.ORD_DT,'YYYYMM') ,T1.RGN_ID ,T1.CUS_GD;
```

ì „ì²´ í•©ê³„ë¥¼ êµ¬í•  ë•ŒëŠ” ê´„í˜¸ê°€ ë‘ê°œë‹¤.  

ROLLUPì•ˆì— ì •ì˜ëœ ëª¨ë“  ì»¬ëŸ¼ì´ í•˜ë‚˜ë¡œ ì¸ì‹ë˜ì–´, ì „ì²´í•©ê³„ë§Œ êµ¬í•  ìˆ˜ ìžˆë‹¤.

## GROUPING

- ì»¬ëŸ¼ê°’ì´ ì†Œê³„ì¸ì§€ ì•„ë‹Œì§€ êµ¬ë¶„í•´ì¤€ë‹¤. í•´ë‹¹ ì»¬ëŸ¼ì´ ROLLUP ì²˜ë¦¬ë˜ì—ˆìœ¼ë©´ 1ì„ ë°˜í™˜í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ 0 ë°˜í™˜.
- ROLLUPìœ¼ë¡œ ì†Œê³„ë¥¼ ë§Œë“  ì»¬ëŸ¼ì´ NULLë¡œ í‘œì‹œë˜ì–´, ì‹¤ì œ ë°ì´í„°ê°€ NULLì¸ì§€, ROLLUPëœ ê²°ê³¼ì¸ì§€ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ì›Œì§€ê¸° ë•Œë¬¸ì— GROUPINGì´ í•„ìš”í•˜ë‹¤. 
- ROLLUPëœ ì»¬ëŸ¼ì„ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ì¹˜í™˜í•  ë•ŒëŠ” ê¼­ GROUPINGì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```SQL
	-- NULLì´ ì¡´ìž¬í•˜ëŠ” ì»¬ëŸ¼ì¸ PAY_TPì— ëŒ€í•´ ROLLUPì„ ìˆ˜í–‰. GROUPINGí•¨ìˆ˜ ì‚¬ìš©
	SELECT  T1.ORD_ST ,GROUPING(T1.ORD_ST) GR_ORD_ST 
			,T1.PAY_TP ,GROUPING(T1.PAY_TP) GR_PAY_TP
			,COUNT(*) ORD_CNT
	FROM    T_ORD T1
	GROUP BY ROLLUP(T1.ORD_ST, T1.PAY_TP);
```

### ðŸ“ROLLUP ê´€ë ¨ ê¸°ì–µí•  ê²ƒë“¤

1. ì—¬ëŸ¬ ê°œ ì¹¼ëŸ¼ì´ `GROUP BY`ë  ë•Œ ì „ì²´ í•©ê³„ë§Œ í•„ìš”í•˜ë‹¤ë©´ **GROUP BY ROLLUP((A, B, C, D))**ì™€ ê°™ì´ ì‚¬ìš©í•œë‹¤.
2. ì—¬ëŸ¬ ì¹¼ëŸ¼ ì¤‘ ì•ž 3ê°œ ì»¬ëŸ¼ê¹Œì§€ì˜ ì†Œê³„ì™€ ì „ì²´í•©ê³„ê°€ í•„ìš”í•˜ë‹¤ë©´ **GROUP BY ROLLUP(A, B, C, (D, E, F))**ì™€ ê°™ì´ ì‚¬ìš©í•œë‹¤.

#### ROLLUPì„ ëŒ€ì‹ í•˜ëŠ” ì„¸ ê°€ì§€ ë°©ë²•

##### 1. UNION ALL

- `ROLLUP`ëŒ€ì‹ ì— í”í•˜ê¸° ì‚¬ìš©í•˜ëŠ” ë°©ë²•.
- ì„±ëŠ¥ì—ì„œ ì†í•´ë¥¼ ë³¼ ìˆ˜ ìžˆë‹¤. `UNION ALL`ì´ ë§Žì•„ì§ˆìˆ˜ë¡ `SELECTì ˆ`ì˜ ì»¬ëŸ¼ ìˆœì„œë¥¼ ë§žì¶”ëŠ” ìž‘ì—…ì´ ë²ˆê±°ë¡­ë‹¤.

```SQL
	-- ROLLUPì„ UNION ALLë¡œ ëŒ€ì‹ í•˜ê¸°
	SELECT  TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM ,T1.CUS_ID
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
	WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
	AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
	GROUP BY TO_CHAR(T1.ORD_DT,'YYYYMM') ,T1.CUS_ID
	UNION ALL
	SELECT  TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM ,'Total' CUS_ID
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
	WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
	AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
	GROUP BY TO_CHAR(T1.ORD_DT,'YYYYMM')
	UNION ALL
	SELECT  'Total' ORD_YM ,'Total' CUS_ID
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
	WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
	AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD');
```

##### 2. ì¹´ë¥´í…Œì‹œì•ˆ ì¡°ì¸

ì¡°ì¸ì¡°ê±´ì„ ì£¼ì§€ ì•Šê³  ì§‘í•©ì„ êµ¬ì„±í•˜ëŠ” ëª¨ë“  ë°ì´í„°ì˜ ì¡°ì¸ì´ ë°œìƒí•œë‹¤. ì¡°ì¸ ê³¼ì •ì—ì„œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.

```SQL
	-- ROLLUPì„ ì¹´í…Œì‹œì•ˆ ì¡°ì¸ìœ¼ë¡œ ëŒ€ì‹ í•˜ê¸°
	SELECT  CASE WHEN T2.RNO = 1 THEN TO_CHAR(T1.ORD_DT,'YYYYMM')
				  WHEN T2.RNO = 2 THEN TO_CHAR(T1.ORD_DT,'YYYYMM')
				  WHEN T2.RNO = 3 THEN 'Total' END ORD_YM
			,CASE WHEN T2.RNO = 1 THEN T1.CUS_ID
				  WHEN T2.RNO = 2 THEN 'Total'
				  WHEN T2.RNO = 3 THEN 'Total' END CUS_ID
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
			,(
				SELECT ROWNUM RNO FROM DUAL CONNECT BY ROWNUM <= 3
			) T2
	WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
	AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
	GROUP BY CASE WHEN T2.RNO = 1 THEN TO_CHAR(T1.ORD_DT,'YYYYMM')
				  WHEN T2.RNO = 2 THEN TO_CHAR(T1.ORD_DT,'YYYYMM')
				  WHEN T2.RNO = 3 THEN 'Total' END
			,CASE WHEN T2.RNO = 1 THEN T1.CUS_ID
				  WHEN T2.RNO = 2 THEN 'Total'
				  WHEN T2.RNO = 3 THEN 'Total' END;
```

##### 3. WITH ì™€ UNION ALL

```SQL
	-- ROLLUPì„ WITH ì ˆê³¼ UNION ALLë¡œ ëŒ€ì²´
	WITH T_RES AS(
		  SELECT  TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM ,T1.CUS_ID
				  ,SUM(T1.ORD_AMT) ORD_AMT
		  FROM    T_ORD T1
		  WHERE   T1.CUS_ID IN ('CUS_0001','CUS_0002')
		  AND     T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD') 
		  AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
		  GROUP BY TO_CHAR(T1.ORD_DT,'YYYYMM') ,T1.CUS_ID
		  )
	SELECT  T1.ORD_YM ,T1.CUS_ID ,T1.ORD_AMT
	FROM    T_RES T1
	UNION ALL
	SELECT  T1.ORD_YM ,'Total' ,SUM(T1.ORD_AMT)
	FROM    T_RES T1
	GROUP BY T1.ORD_YM
	UNION ALL
	SELECT  'Total' ,'Total' ,SUM(T1.ORD_AMT)
	FROM    T_RES T1;
```

### CUBE

- ì¡°í•© ê°€ëŠ¥í•œ ëª¨ë“  ì†Œê³„ë¥¼ ë§Œë“¤ì–´ ë‚¸ë‹¤.
- ë¬¸ë²•: `ROLLUP`ê³¼ ë™ì¼
  - ì˜ˆì‹œ: GROUP BY CUBE(A, B, C)
    - A+Bë³„ ì†Œê³„
    - Aë³„ ì†Œê³„
    - A+Cë³„ ì†Œê³„
    - B+Cë³„ ì†Œê³„
    - Bë³„ ì†Œê³„
    - Cë³„ ì†Œê³„

- ì»¬ëŸ¼ì´ ë§Žê³  ì²˜ë¦¬í•  ë°ì´í„°ê°€ ë§Žì„ìˆ˜ë¡ ì„±ëŠ¥ì´ ì¢‹ì§€ ëª»í•˜ë‹¤.

### GROUPING SETS

- `ROLLUP`ì´ë‚˜ `CUBE`ì²˜ëŸ¼ ì†Œê³„ë¥¼ ë§Œë“ ë‹¤.
- ë¬¸ë²• : `GROUP BY`ë’¤ì— `ROLLUP`, `CUBE`ëŒ€ì‹ ì— `GROUPING SETS`ë¼ê³  í‘œê¸°í•œ ã……í›„, ê·¸ë£¹í™”í•  ì»¬ëŸ¼ì„ ê´„í˜¸ë¡œ ë¬¶ì–´ ë‚˜ì—´
- ì†Œê³„ê°€ í•„ìš”í•œ ì§‘í•©ì„ ì¼ì¼ì´ ì§€ì •í•  ìˆ˜ ìžˆë‹¤.

```SQL
	-- ì£¼ë¬¸ë…„ì›”, ê³ ê°IDë³„ ì£¼ë¬¸ê±´ìˆ˜ì™€ ì£¼ë¬¸ ê¸ˆì•¡ â€“ GROUPING SETS í™œìš©
	SELECT  TO_CHAR(T1.ORD_DT,'YYYYMM') ORD_YM
			,T1.CUS_ID
			,COUNT(*) ORD_CNT
			,SUM(T1.ORD_AMT) ORD_AMT
	FROM    T_ORD T1
	WHERE   T1.ORD_DT >= TO_DATE('20170301','YYYYMMDD')
	AND     T1.ORD_DT < TO_DATE('20170501','YYYYMMDD')
	AND     T1.CUS_ID IN ('CUS_0061','CUS_0062')
	GROUP BY GROUPING SETS(
					  (TO_CHAR(T1.ORD_DT,'YYYYMM'),T1.CUS_ID)  --GROUP BYê¸°ë³¸ ë°ì´í„°
					  ,(TO_CHAR(T1.ORD_DT,'YYYYMM'))  --ì£¼ë¬¸ë…„ì›”ë³„ ì†Œê³„
					  ,(T1.CUS_ID)  --ê³ ê°IDë³„ ì†Œê³„
					  ,()   --ì „ì²´í•©ê³„
				  );
```

###### reference

> SQL BOOSTER