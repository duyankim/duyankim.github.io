---
layout: post
author: "Yan"
catalog: true
subtitle: "Kafka docker-compose.yml"
header-img: "img/header/none3.jpg"
title: "Kafka ì„¤ì •í•˜ê¸°"
date: 2025-04-08 11:40:08 +0000
categories:
  - CICD
tags:
  - Kafka
  - ë°°í¬
---

# Kafka ë¸Œë¡œì»¤ êµ¬ì„±í•˜ëŠ” ë°©ë²•

## Zookeeper + Kafka ë¸Œë¡œì»¤ 3ê°œ êµ¬ì„±ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ë§Œë“¤ê¸°

ì´ ì˜ˆì œì˜ êµ¬ì¡°: 

```
ğŸ“¦ docker-compose.yml
â”œâ”€â”€ zookeeper  â† ë¸Œë¡œì»¤ë“¤ì„ ê´€ë¦¬í•˜ëŠ” ì¤‘ì•™ ì»¨íŠ¸ë¡¤ëŸ¬
â”œâ”€â”€ kafka1     â† ë¸Œë¡œì»¤1 (í¬íŠ¸ 19092)
â”œâ”€â”€ kafka2     â† ë¸Œë¡œì»¤2 (í¬íŠ¸ 19093)
â””â”€â”€ kafka3     â† ë¸Œë¡œì»¤3 (í¬íŠ¸ 19094)
```

### Zookeeper ì„¤ì •í•˜ê¸°

ì¹´í”„ì¹´ëŠ” ë¸Œë¡œì»¤ë“¤ë¼ë¦¬ ì¡°ìœ¨í•  ë•Œ **Zookeeper**ë¥¼ í†µí•´ ì •ë³´ë¥¼ ê³µìœ í•œë‹¤.  
ë¨¼ì € Zookeeper ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

```yml
zookeeper:
  image: confluentinc/cp-zookeeper:latest
  environment:
    ZOOKEEPER_SERVER_ID: 1
    ZOOKEEPER_CLIENT_PORT: 2181  # ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ í¬íŠ¸
  ports:
    - "22181:2181" # ì™¸ë¶€ì—ì„œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ í¬íŠ¸ 22181ë¡œ ì™¸ë¶€ì— ë…¸ì¶œí•œë‹¤
```

### Kafka ë¸Œë¡œì»¤ ì„¤ì •í•˜ê¸°

ê°ê°ì˜ ë¸Œë¡œì»¤ (kafka1, kafka2, kafka3)ëŠ” ì•„ë˜ ì„¤ì •ì„ ë™ì¼í•˜ê²Œ ì ìš©í•œë‹¤. XëŠ” ê° ë¸Œë¡œì»¤ì˜ idë„˜ë²„ë‹¤.

```yml
image: confluentinc/cp-kafka:latest
depends_on:
  - zookeeper
ports:
  - "1909X:1909X" # ë¡œì»¬ í¬íŠ¸ : ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í¬íŠ¸ â†’ í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ì†í•˜ë ¤ë©´ ë¡œì»¬ í¬íŠ¸ë¥¼ ì´ìš©í•´ì•¼ í•˜ë¯€ë¡œ, ê° ë¸Œë¡œì»¤ë§ˆë‹¤ ì™¸ë¶€ ë…¸ì¶œ í¬íŠ¸ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •
environment:
  KAFKA_BROKER_ID: X       # ë¸Œë¡œì»¤ ID: ê°ê¸° ë‹¤ë¥´ê²Œ ì§€ì •í•´ì•¼ í•¨
  KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181' # ì¹´í”„ì¹´ê°€ ì¡°ìœ¨ë°›ì„ Zookeeper ì£¼ì†Œ
  KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT # ë¦¬ìŠ¤ë„ˆ ì´ë¦„ â†’ í”„ë¡œí† ì½œ ë§¤í•‘
  KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafkaX:909X,EXTERNAL://localhost:1909X
  KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL # ë¸Œë¡œì»¤ ê°„ í†µì‹ ìš© ë¦¬ìŠ¤ë„ˆ ì§€ì •
```

- `KAFKA_ADVERTISED_LISTENERS`:
  - **INTERNAL**: ë¸Œë¡œì»¤ë¼ë¦¬ í†µì‹ í•  ë•Œ ì‚¬ìš©
  - **EXTERNAL**: í´ë¼ì´ì–¸íŠ¸ (ë¡œì»¬PC ë“±)ê°€ ì ‘ì†í•  ë•Œ ì‚¬ìš©

- ì˜ˆì‹œ:
  - EXTERNAL://localhost:19092 â† í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ê·¼í•  ë•Œ ì ‘ì† ì£¼ì†Œ
  - INTERNAL://kafka1:9092 â† ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ ë¸Œë¡œì»¤ë¼ë¦¬ ì‚¬ìš©í•  ì£¼ì†Œ


docker-compose.yml ì „ì²´

```yml
version: "3.8"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    environment:
      ZOOKEEPER_SERVER_ID: 1
      ZOOKEEPER_CLIENT_PORT: 2181
    ports:
      - "22181:2181"

  kafka1:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    ports:
      - "19092:19092"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka1:9092,EXTERNAL://localhost:19092
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL

  kafka2:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    ports:
      - "19093:19093"
    environment:
      KAFKA_BROKER_ID: 2
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka2:9093,EXTERNAL://localhost:19093
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL


  kafka3:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    ports:
      - "19094:19094"
    environment:
      KAFKA_BROKER_ID: 3
      KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka3:9094,EXTERNAL://localhost:19094
      KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
```


### ì‹œì‘ ë°©ë²•

docker-compose.yml ì €ì¥ í›„ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰

```
docker-compose up -d
```

í™•ì¸ ë°©ë²• 

```
docker ps
```

ë¸Œë¡œì»¤ 1ì— í† í”½ ë§Œë“¤ê³  í…ŒìŠ¤íŠ¸ í•˜ë ¤ë©´

```
# í† í”½ ìƒì„±
docker exec -it <kafka1-container-id> \
  kafka-topics --bootstrap-server localhost:9092 --create --topic test-topic --partitions 3 --replication-factor 3

# ë©”ì‹œì§€ ë³´ë‚´ê¸°
docker exec -it <kafka1-container-id> \
  kafka-console-producer --bootstrap-server localhost:9092 --topic test-topic

# ë©”ì‹œì§€ ì†Œë¹„
docker exec -it <kafka2-container-id> \
  kafka-console-consumer --bootstrap-server localhost:9093 --topic test-topic --from-beginning
```
