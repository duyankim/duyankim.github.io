---
layout: post
author: "Yan"
# catalog: false
subtitle: "Security & JWT"
header-img: "img/header/spring.jpg"
title: "Spring - Security, JWT, ì¸ì¦, ì¸ê°€ì— ëŒ€í•´"
date: 2022-08-01 11:40:08 +0000
categories:
  - Spring
tags:
  - Spring
  - JWT
  - java
# toc: true
comments: true
---

# ğŸ“Œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹° (Spring Security)
- ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ(ì¸ì¦ ë° ì¸ê°€)ì„ ë‹´ë‹¹í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- ì„œë¸”ë¦¿ í•„í„°ì™€ ì´ë“¤ë¡œ êµ¬ì„±ëœ **filterChain**ìœ¼ë¡œ êµ¬ì„±ëœ ìœ„ì„ ëª¨ë¸ì„ ì‚¬ìš©í•œë‹¤.
- ë³´ì•ˆ ê´€ë ¨í•´ì„œ ë§ì€ ì˜µì…˜ì„ ì œê³µí•´ì£¼ì–´ ê°œë°œìê°€ ì¼ì¼ì´ ë³´ì•ˆ ê´€ë ¨ ë¡œì§ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.
- Spring Securityë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ìì²´ì ìœ¼ë¡œ ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì²´í¬í•˜ë˜ê°€ ê¸°íƒ€ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì²´í¬ë¥¼ í•´ì£¼ì–´ì•¼ í•œë‹¤.

### ğŸ‘ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì¢‹ì€ ì´ìœ 
- ë³´ì•ˆê³¼ ê´€ë ¨í•˜ì—¬ ì²´ê³„ì ìœ¼ë¡œ ë§ì€ ì˜µì…˜ì„ ì œê³µí•˜ì—¬ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- Filter ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ì—¬ MVCì™€ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬ ë° ë™ì‘ 
- ì–´ë…¸í…Œì´ì…˜ì„ í†µí•œ ê°„ë‹¨í•œ ì„¤ì •
- Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„¸ì…˜ & ì¿ í‚¤ë°©ì‹ìœ¼ë¡œ ì¸ì¦

## ì¸ì¦ê³¼ ì¸ê°€ëŠ” ë¬´ì—‡ì¸ê°€?
- ì¸ì¦`Authentication`: í•´ë‹¹ ì‚¬ìš©ìê°€ ë³¸ì¸ì´ ë§ëŠ”ì§€ë¥¼ í™•ì¸í•˜ëŠ” ì ˆì°¨
- ì¸ê°€`Authorization`: ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìš”ì²­í•œ ìì›ì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ë¥¼ ê²°ì •í•˜ëŠ” ì ˆì°¨
- Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¸ì¦ ì ˆì°¨ë¥¼ ê±°ì¹œ í›„ì— ì¸ê°€ ì ˆì°¨ë¥¼ ì§„í–‰í•˜ê²Œ ëœë‹¤.
- ì¸ì¦ì€ ì‚¬ìš©ìì˜ ì‹ ì› í™•ì¸ì— ê´€í•œ ê³¼ì •ì´ë©°, ì¸ê°€ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ê¸°ëŠ¥ì— ëŒ€í•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •. ì¼ë°˜ì ìœ¼ë¡œ ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì‚¬ìš©ìì˜ ì¸ì¦ì„ ì²˜ë¦¬í•˜ê³ , ê·¸ ì´í›„ì˜ ê¶Œí•œ ê²€ì‚¬ëŠ” ì¸ê°€ì— í•´ë‹¹.
- Spring Securityì—ì„œëŠ” ì´ëŸ¬í•œ ì¸ì¦ê³¼ ì¸ê°€ë¥¼ ìœ„í•´ Principalì„ ì•„ì´ë””ë¡œ, Credentialì„ ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©í•˜ëŠ” Credential ê¸°ë°˜ì˜ ì¸ì¦ ë°©ì‹ì„ ì‚¬ìš©í•œë‹¤.Â 

## Spring Securityì˜ êµ¬ì¡°

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99A7223C5B6B29F003)

spring securityëŠ” ì„¸ì…˜-ì¿ í‚¤ë°©ì‹ìœ¼ë¡œ ì¸ì¦  

1. ìœ ì €ê°€ ë¡œê·¸ì¸ì„ ì‹œë„ (http request)
2. AuthenticationFilter ì—ì„œë¶€í„° ìœ„ì™€ê°™ì´ user DBê¹Œì§€ íƒ€ê³  ë“¤ì–´ê°
3. DBì— ìˆëŠ” ìœ ì €ë¼ë©´ UserDetails ë¡œ êº¼ë‚´ì„œ ìœ ì €ì˜ session ìƒì„±
4. spring securityì˜ ì¸ë©”ëª¨ë¦¬ ì„¸ì…˜ì €ì¥ì†Œì¸ SecurityContextHolderì— ì €ì¥
5. ìœ ì €ì—ê²Œ session IDì™€ í•¨ê»˜ ì‘ë‹µì„ ë‚´ë ¤ì¤Œ
6. ì´í›„ ìš”ì²­ì—ì„œëŠ” ìš”ì²­ì¿ í‚¤ì—ì„œ session IDë¥¼ ê¹Œë´ì„œ ê²€ì¦ í›„ ìœ íš¨í•˜ë©´ Authenticationë¥¼ ì¥ì–´ì¤€ë‹¤.

### ğŸª ì„¸ì…˜-ì¿ í‚¤ ì¸ì¦ ë°©ì‹ì€ ë¬´ì—‡ì¸ê°€?

> ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©°, ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ì„ í•  ë•Œë§ˆë‹¤ ì„¸ì…˜ IDë¥¼ ì„œë²„ì— ì œê³µí•˜ì—¬ ì„¸ì…˜ì„ í™•ì¸í•˜ëŠ” ë°©ì‹  

ì„¸ì…˜-ì¿ í‚¤ ì¸ì¦ ë°©ì‹ì€ ì‚¬ìš©ì´ í¸ë¦¬í•˜ê³  ê°œë°œì´ ê°„í¸í•˜ì§€ë§Œ, ë³´ì•ˆ ì¸¡ë©´ì—ì„œëŠ” ì£¼ì˜ê°€ í•„ìš”í•˜ë©° ì„œë²„ ë©”ëª¨ë¦¬ ë¶€í•˜ì™€ ë³´ì•ˆ ì·¨ì•½ì ì— ëŒ€í•œ ê³ ë ¤ê°€ í•„ìš”í•˜ë‹¤. ìµœê·¼ì—ëŠ” í† í° ê¸°ë°˜ì˜ ì¸ì¦ ë°©ì‹(JWT ë“±)ì´ ë” ë§ì´ ì‚¬ìš©ë˜ëŠ” ê²½í–¥ì´ ìˆë‹¤.

#### ì„¸ì…˜-ì¿ í‚¤ ì¸ì¦ ë°©ì‹ Sequence Diagram

```mermaid
sequenceDiagram;
    participant User;
    participant Browser;
    participant Server;
    participant Database;

    User->>Browser: ë¡œê·¸ì¸ ìš”ì²­;
    Browser->>Server: ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì „ì†¡ (e.g., ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸);
    Server->>Database: ì‚¬ìš©ì ì •ë³´ ê²€ìƒ‰;
    Database-->>Server: ì‚¬ìš©ì ì •ë³´ ë°˜í™˜;
    Server-->>Browser: ì„¸ì…˜ ID ìƒì„± ë° ì¿ í‚¤ ì„¤ì •;
    Browser-->>Server: ì„¸ì…˜ IDì™€ í•¨ê»˜ ìš”ì²­ ì „ì†¡ (ì¿ í‚¤ë¡œ ì „ì†¡);

    loop ì¸ì¦ ìœ ì§€ ì¤‘;
        Browser->>Server: ì„¸ì…˜ IDì™€ í•¨ê»˜ ìš”ì²­ ì „ì†¡ (ì¿ í‚¤ë¡œ ì „ì†¡);
        Server-->>Browser: ìš”ì²­ ì²˜ë¦¬ ë° ì‘ë‹µ;
    end;

    User->>Browser: ë¡œê·¸ì•„ì›ƒ ìš”ì²­;
    Browser->>Server: ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì „ì†¡;
    Server-->>Browser: ì„¸ì…˜ ë§Œë£Œ ë° ì¿ í‚¤ ì œê±°;
```

##### ì¸ì¦ í”„ë¡œì„¸ìŠ¤

(1) ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ì‹œë„  
(2) ë¸Œë¼ìš°ì €ëŠ” ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´(ì˜ˆ: ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸)ë¥¼ ì„œë²„ë¡œ ì „ì†¡  
(3) ì„œë²„ëŠ” ì „ë‹¬ë°›ì€ ì¸ì¦ ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ê²€ìƒ‰  
(4) ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ì„œë²„ì— ë°˜í™˜  

##### ì¸ê°€ í”„ë¡œì„¸ìŠ¤

(5) ì„œë²„ëŠ” ì„¸ì…˜ IDë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ ì¿ í‚¤ì— ë‹´ì•„ ë¸Œë¼ìš°ì €ë¡œ ì „ì†¡  
(6) ë¸Œë¼ìš°ì €ëŠ” ì´í›„ì˜ ëª¨ë“  ìš”ì²­ì—ì„œ ì„¸ì…˜ IDë¥¼ ì¿ í‚¤ë¥¼ í†µí•´ ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ ì„¸ì…˜ì„ ìœ ì§€  
(7) ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒì„ ìš”ì²­í•˜ë©´, ì„œë²„ëŠ” ì„¸ì…˜ì„ ë§Œë£Œì‹œí‚¤ê³  ê´€ë ¨ëœ ì¿ í‚¤ë¥¼ ì œê±°  

##### ğŸ‘ ì„¸ì…˜-ì¿ í‚¤ ì¸ì¦ ë°©ì‹ì˜ ì¥ì 

**1. ì‚¬ìš©ì´ í¸ë¦¬í•˜ê³  ì§ê´€ì **  

ì„¸ì…˜ê³¼ ì¿ í‚¤ëŠ” ê°œë°œìê°€ ì§ì ‘ ê´€ë¦¬í•  í•„ìš” ì—†ì´ ë¸Œë¼ìš°ì €ì™€ ì„œë²„ ì‚¬ì´ì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ìƒëŒ€ì ìœ¼ë¡œ ì‚¬ìš©ì´ í¸ë¦¬í•˜ê³  ì§ê´€ì 

**2. ì„œë²„ ë¶€í•˜ ê°ì†Œ**  

ì„¸ì…˜-ì¿ í‚¤ ë°©ì‹ì€ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— ì„¸ì…˜ IDë¥¼ ì €ì¥í•˜ê³  ì„œë²„ëŠ” ì„¸ì…˜ ì •ë³´ë¥¼ ì„œë²„ ë©”ëª¨ë¦¬ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì„œë²„ì— ë¶€í•˜ë¥¼ ë¶„ì‚°ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

**3. ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œë„ ì¼ë¶€ ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥**  

ì„¸ì…˜-ì¿ í‚¤ ë°©ì‹ì—ì„œëŠ” ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì¼ë¶€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤.

##### ğŸ‘ ì„¸ì…˜-ì¿ í‚¤ ì¸ì¦ ë°©ì‹ì˜ ë‹¨ì 

**1. ì„œë²„ ë©”ëª¨ë¦¬ ë¶€í•˜**  

ì„¸ì…˜ì„ ì„œë²„ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” ê²½ìš°, ë§ì€ ì‚¬ìš©ìê°€ ë™ì‹œì— ì ‘ì†í•˜ëŠ” ê²½ìš° ì„œë²„ ë©”ëª¨ë¦¬ ë¶€í•˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

**2. ì„¸ì…˜ í•˜ì´ì¬í‚¹ ìœ„í—˜**  

ì„¸ì…˜ IDë¥¼ íƒˆì·¨í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ ê°€ë¡œì±„ëŠ” ì„¸ì…˜ í•˜ì´ì¬í‚¹ ê³µê²©ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì„¸ì…˜ì— ëŒ€í•œ ë³´ì•ˆ ê°•í™”ê°€ í•„ìš”í•˜ë‹¤.

**3. ë¡œê·¸ì¸ ìƒíƒœì˜ ìœ ì§€**  

ì„¸ì…˜-ì¿ í‚¤ ë°©ì‹ì€ ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒí•˜ê±°ë‚˜ ì„¸ì…˜ì´ ë§Œë£Œë˜ê¸° ì „ê¹Œì§€ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤. ì´ëŠ” ì‚¬ìš©ìê°€ ì˜ë„ì¹˜ ì•Šê²Œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

###### 4. CSRF ê³µê²© ê°€ëŠ¥ì„±

ì¿ í‚¤ë¥¼ ì‚¬ìš©í•œ ê²½ìš°, CSRF ê³µê²©ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì´ì— ëŒ€í•œ ë°©ì–´ ë©”ì»¤ë‹ˆì¦˜ì´ ì¶”ê°€ë¡œ í•„ìš”í•˜ë‹¤.

## ğŸ“ŒSpring Security ì ìš©ì‹œ í•„ìˆ˜ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ê²ƒë“¤ì˜ ëª©ë¡

1. Spring Security Dependency ì ìš©
2. Spring Security Configuration í´ë˜ìŠ¤ êµ¬í˜„
3. UserDetailsService ìƒì† (ì¸ì¦ Provider ë˜ëŠ” UserDetailsService êµ¬í˜„)
4. CSRF Token Header

#### âœ” 1. Spring Security Dependency ì˜ˆì‹œ

build.gradle

```groovy
dependencies {
  implementation 'org.springframework.boot:spring-boot-starter-security'
}
```

#### âœ” 2. Spring Security Config

Spring Securityì—ì„œ ê°ì¢… ì¸ì¦/ì¸ê°€ì™€ ê´€ë ¨ëœ ì„¤ì • ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³ ,  
`WebSecurityConfigurerAdapter`ë¼ëŠ” ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´,  
ê¸°ë³¸ ìë™ êµ¬ì„±ì´ ë¹„í™œì„±í™”ë˜ê³  ì‚¬ìš©ìê°€ ì§€ì •í•œ ë³´ì•ˆ configë¥¼ í™œì„±í™” ì‹œí‚¬ ìˆ˜ ìˆë‹¤.  

`WebSecurityConfigurerAdapter`ëŠ” ê¸°ë³¸ ë³´ì•ˆ ì„¤ì •ì„ ì œê³µí•˜ê³ , ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë”©ì„ í†µí•œ ë³´ì•ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ ì œê³µí•œë‹¤.

`@EnableWebSecurity` ì–´ë…¸í…Œì´ì…˜ : spring securityë¥¼ í™œì„±í™”í•˜ê³  ë³´ì•ˆ configë¥¼ í™œì„±í™”ì‹œí‚´

ğŸ’¡ _Spring Security 5.4 ì´í›„ë¶€í„°Â WebSecurityConfigurerAdapterê°€ Deprecated ë˜ì—ˆë‹¤._  

> `WebSecurityConfigurerAdapter`ë¥¼ ìƒì†í•˜ê±°ë‚˜ `SecurityConfigurerAdapter`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³´ì•ˆì— ëŒ€í•œ ì„¤ì •ì„ ì •ì˜í•œë‹¤. ë³´í†µ @Configuration ë° @EnableWebSecurity ì–´ë…¸í…Œì´ì…˜ì„ í´ë˜ìŠ¤ì— ì¶”ê°€í•œë‹¤.  

> ì•¡ì„¸ìŠ¤ ê¶Œí•œ ë¶€ì—¬ ê·œì¹™ ì„¤ì •: ì–´ë–¤ URL íŒ¨í„´ì— ì–´ë–¤ ì—­í• (role)ì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ì •í•´ì•¼ í•œë‹¤. ì´ëŠ” configure(HttpSecurity http) ë©”ì„œë“œì—ì„œ ìˆ˜í–‰í•œë‹¤.

WebSecurityConfigurerAdapterë¥¼ ìƒì†ë°›ì•„ ì»¤ìŠ¤í…€í•œ AuthenticationConfig í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” AuthenticationConfig 

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.http.SessionCreationPolicy;

@Configuration
@EnableWebSecurity
public class AuthenticationConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().disable()
                .authorizeRequests()
                .antMatchers("/api/*/users/join", "/api/*/users/login").permitAll()
                .antMatchers("/api/**").authenticated()
                .and()
                .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                ;
    }
}
```

> "/api/*/users/join", "/api/*/users/login" ì—”ë“œí¬ì¸íŠ¸ëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆì˜¹  
> "/api/**"íŒ¨í„´ì— í•´ë‹¹í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì—ê²Œë§Œ í—ˆìš©í•˜ëŠ” statelessí•œ ë³´ì•ˆ êµ¬ì„±

(1) `@Configuration` : ì´ í´ë˜ìŠ¤ê°€ ìŠ¤í”„ë§ì˜ ì„¤ì • í´ë˜ìŠ¤ì„ì„ ë‚˜íƒ€ëƒ„  
(2) `@EnableWebSecurity` : ì›¹ ë³´ì•ˆì„¤ì •ì„ í™œì„±í™”í•˜ë„ë¡ í•¨  
(3) `@http.csrf().disable()` : CSRF ë³´í˜¸ë¥¼ ë¹„í™œì„±í™” ì²˜ë¦¬. ì£¼ë¡œ statelessí•œ RESTful ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë¨  
(4) `.authorizeRequests()` : ìš”ì²­ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ ì„¤ì •  
  - `.antMatchers("/api/*/users/join", "/api/*/users/login").permitAll()` : `"/api/*/users/join", "/api/*/users/login"`ì— ëŒ€í•œ ìš”ì²­ì€ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆìš©
  - `.antMatchers("/api/**").authenticated()` : `"/api/**"`ì— ëŒ€í•œ ìš”ì²­ì€ ì¸ì¦ëœ ì‚¬ìš©ìì—ê²Œë§Œ í—ˆìš©  

(5) `.and()` : ë‹¤ìŒ ì„¤ì •ì„ ì—°ê²°  
(6) `.sessionManagement()` : ì„¸ì…˜ ê´€ë¦¬ ì„¤ì •ì„ êµ¬ì„±  
  -`.sessionCreationPolicy(SessionCreationPolicy.STATELESS)` : ì„œë²„ëŠ” ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•Šê³ , ê° ìš”ì²­ì€ ì„œë²„ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬ë¨. ì£¼ë¡œ statelessí•œ RESTful ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë¨

âœ” **deprecatedëœ WebSecurityConfigurerAdapterë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  êµ¬í˜„í•˜ëŠ” ë°©ë²•**

deprecatedëœ ë°©ë²•

```java
@Configuration
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests((authz) -> authz
                .anyRequest().authenticated()
            )
            .httpBasic(withDefaults());
    }

}
```

ğŸ’¡ WebSecurityConfigurerAdapterë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  êµ¬í˜„í•˜ëŠ” ë°©ë²•

```java
@Configuration
public class SecurityConfiguration {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests((authz) -> authz
                .anyRequest().authenticated()
            )
            .httpBasic(withDefaults());
        return http.build();
    }

}
```

[spring ê³µì‹ ë¬¸ì„œ](https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter)

##### HttpSecurityëŠ” ë¬´ì—‡ì¸ê°€?

Spring Securityì—ì„œëŠ” ì¸ì¦, ì¸ê°€ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ì—¬ëŸ¬ê°œì˜ í•„í„°ë¥¼ ì—°ì‡„ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ìˆ˜í–‰í•œë‹¤. `WebSecurityConfigurerAdapter`ë¥¼ êµ¬í˜„í•œ ì„¤ì • íŒŒì¼ì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ `HttpSecurity`ë¥¼ `configure(HttpSecurity http)` ë©”ì„œë“œë¥¼ í†µí•´ í•„í„°ê°€ ìƒì„±ë˜ê³  êµ¬ì„±ëœë‹¤.  

ì´ ë•Œ, ë³´ì•ˆ ì„¤ì •ì„ ì •ì˜í•˜ëŠ”(= ì‹¤ì œ í•„í„°ë¥¼ ìƒì„±í•˜ëŠ” í´ë˜ìŠ¤)ê°€ ë°”ë¡œ `HttpSecurity`ë‹¤.  

`HttpSecurity`í´ë˜ìŠ¤ë¥¼ ì—´ì–´ë³´ë©´ addFilterê°™ì€ ë©”ì†Œë“œê°€ ì •ì˜ë˜ì–´ ìˆë‹¤.  

`HttpSecurity`ëŠ” ì²´ì´ë‹ ë©”ì„œë“œë¥¼ í†µí•´ ì—¬ëŸ¬ ì„¤ì •ì„ ì¶”ê°€í•˜ê³  ê·œì¹™ì„ ì •ì˜í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `authorizeRequests()`, `formLogin()`, `logout()` ë“±ì„ í˜¸ì¶œí•˜ì—¬ ë³´ì•ˆ ê·œì¹™ì„ êµ¬ì„±í•©ë‹ˆë‹¤.  

```mermaid
graph TD
  subgraph WebSecurityConfigurerAdapter
    A["configure(HttpSecurity http)"]
  end

  subgraph HttpSecurity
    B["HttpSecurity http = new HttpSecurity()"]
    C["http.authorizeRequests()"]
    D["http.formLogin()"]
    E["http.logout()"]
    F["http.csrf()"]
  end

  A -->|creates| B
  B -->|configures| C
  B -->|configures| D
  B -->|configures| E
  B -->|configures| F
```

ì„¤ì • íŒŒì¼ ë³„ë¡œ í•„í„° ëª©ë¡ì„ ê°–ê²Œ ëœ í›„, ì´ í•„í„°ë“¤ì€ `WebSecurity` í´ë˜ìŠ¤ì—ê²Œ ì „ë‹¬ì´ ëœë‹¤.  

`WebSecurity`ëŠ” ê°ê° ì„¤ì • í´ë˜ìŠ¤ë¡œ ë¶€í„° í•„í„° ëª©ë¡ë“¤ì„ ì „ë‹¬ë°›ê³ , ë‹¤ì‹œ `FilterChainProxy`ë¥¼ ìƒì„±ìì˜ ì¸ìë¡œ ì „ë‹¬í•œë‹¤.  

FilterChainProxyëŠ” ê°ê°ì˜ ì„¤ì • í´ë˜ìŠ¤ ë³„(SecurityConfig1, SecurityConfig2)ë¡œ í•„í„° ëª©ë¡ë“¤ì„ ê°–ê³  ìˆëŠ” í˜•íƒœê°€ ëœë‹¤.

```mermaid
graph TD
  subgraph WebSecurityConfigurerAdapter
    A["configure(WebSecurity web)"]
  end

  subgraph FilterChainProxy
    B[FilterChainProxy]
  end

  subgraph HttpSecurity
    C["configure(HttpSecurity http)"]
    D["http.authorizeRequests()"]
    E["http.formLogin()"]
    F["http.logout()"]
  end

  A -->|configures| B
  B -->|selects appropriate| B1[FilterChain]
  B1 -->|passes request to| C
  C -->|configures| D
  D -->|configures| E
  E -->|configures| F

```

- `FilterChainProxy`ê°€ ìš”ì²­ì„ ë°›ê³ , ë“±ë¡ëœ ì—¬ëŸ¬ `FilterChain`ì¤‘ì—ì„œ ì ì ˆí•œ ê²ƒì„ ì„ íƒí•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.
- ì„ íƒëœ `FilterChain` ë‚´ì—ì„œëŠ” `HttpSecurity`ë¥¼ ì‚¬ìš©í•˜ì—¬ HTTP ê¸°ë°˜ì˜ ë³´ì•ˆ ì„¤ì •ì„ ì •ì˜í•˜ê³ , ê° ì„¤ì •ì€ ì²´ì´ë‹ ë©”ì„œë“œë¥¼ í†µí•´ ì¶”ê°€ëœë‹¤.
- ìµœì¢…ì ìœ¼ë¡œ `FilterChainProxy`ê°€ ìš”ì²­ì— ëŒ€í•œ ëª¨ë“  í•„í„° ì²´ì¸ì„ ì‹¤í–‰í•˜ì—¬ ë³´ì•ˆ ê·œì¹™ì„ ì ìš©í•œë‹¤.

##### FilterChainProxyë€ ë¬´ì—‡ì¸ê°€?

- Spring Securityì—ì„œ ì‹¤ì œë¡œ Filterë¥¼ ê´€ë¦¬í•˜ê³  ìš”ì²­ì— ëŒ€í•œ ë³´ì•ˆ í•„í„° ì²´ì¸ì„ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤
- ì—¬ëŸ¬ `FilterChain`ì„ ê´€ë¦¬í•˜ì—¬ ê°ê° ë‹¤ë¥¸ íŒ¨í„´ì˜ URLì— ëŒ€í•œ ë³´ì•ˆ ì„¤ì •ì„ ì²˜ë¦¬

**FilterChainì˜ íë¦„**

```mermaid
graph TD
  subgraph SpringSecurityContext
    A[SecurityContextHolder]
    B[Authentication]
  end

  subgraph FilterChainProxy
    C[FilterChainProxy]
  end

  subgraph Filter1
    D[Filter1]
  end

  subgraph Filter2
    E[Filter2]
  end

  subgraph FilterN
    F[FilterN]
  end

  A -->|Security Context| C
  B -->|Authentication| C
  C -->|Filter1| D
  D -->|Filter2| E
  E -->|...| F

```

-` SecurityContextHolder`ì™€ `Authentication`ì€ í˜„ì¬ ì‚¬ìš©ìì˜ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ì™€ ì¸ì¦ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- `FilterChainProxy`ëŠ” ìš”ì²­ì— ëŒ€í•œ ë³´ì•ˆ í•„í„° ì²´ì¸ì„ ê´€ë¦¬í•˜ê³ , ì‹¤ì œë¡œ Filterë¥¼ ì‹¤í–‰í•œë‹¤.
- `FilterChainProxy`ì— ì¡´ì¬í•˜ëŠ” ì—¬ëŸ¬ `FilterChain` ì¤‘ ê° `FilterChain`ì€ íŠ¹ì •í•œ URL íŒ¨í„´ ë˜ëŠ” ê²½ë¡œì— ëŒ€í•œ ë³´ì•ˆ ì„¤ì •ì„ ì •ì˜í•˜ë©°, `FilterChainProxy`ëŠ” ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ `FilterChain` ì¤‘ì—ì„œ ì ì ˆí•œ ê²ƒì„ ì„ íƒí•˜ì—¬ ì‹¤í–‰í•œë‹¤.

###### FilterChain

`FilterChain` ì¸í„°í˜ì´ìŠ¤ì—ëŠ” ë‹¤ìŒ í•„í„°ë¥¼ í˜¸ì¶œí•´ì£¼ëŠ” `doFilter()`ë©”ì†Œë“œê°€ ì •ì˜ë˜ì–´ ìˆë‹¤.

```java
public interface FilterChain {

    /**
     * Causes the next filter in the chain to be invoked, or if the calling
     * filter is the last filter in the chain, causes the resource at the end of
     * the chain to be invoked.
     *
     * @param request
     *            the request to pass along the chain.
     * @param response
     *            the response to pass along the chain.
     *
     * @throws IOException if an I/O error occurs during the processing of the
     *                     request
     * @throws ServletException if the processing fails for any other reason
     */
    public void doFilter(ServletRequest request, ServletResponse response)
            throws IOException, ServletException;

}
```

í•„í„°ë¥¼ ìˆ˜í–‰ í›„ ë„˜ê¸°ê³ , ë‹¤ìŒ í•„í„°ê°€ ìˆ˜í–‰ë˜ê³  ë˜ ë‹¤ìŒ í•„í„°ë¡œ ë„˜ê¸°ëŠ” í˜•íƒœë‹¤.

**ì¼ë°˜ì ì¸ FilterChainì˜ íë¦„ì˜ ì˜ˆì‹œ**

```mermaid
graph TD
  subgraph Request
    A[HTTP Request]
  end

  subgraph FilterChainProxy
    B[FilterChainProxy]
  end

  subgraph Filter1
    C[AuthenticationFilter]
  end

  subgraph Filter2
    D[AuthorizationFilter]
  end

  subgraph Filter3
    E[CustomFilter]
  end

  subgraph Response
    F[HTTP Response]
  end

  A -->|URL Mapping| B
  B -->|Filter1| C
  C -->|Filter2| D
  D -->|Filter3| E
  E -->|Processing| F

```

- ê° `Filter`ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³ , í•„ìš”ì— ë”°ë¼ `FilterChainProxy`ëŠ” ê·¸ ë‹¤ìŒì— ì‹¤í–‰ë  í•„í„°ë¥¼ ê²°ì •í•œë‹¤.

##### CSRF `Cross-Site Request Forgery` ë€ ë¬´ì—‡ì¸ê°€?

- ì•…ì˜ì ì¸ ì›¹ì‚¬ì´íŠ¸ê°€ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê¶Œí•œìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê³µê²©
- ì‚¬ìš©ìê°€ ì´ë¯¸ ì¸ì¦ëœ ìƒíƒœì—ì„œ ê³µê²©ìê°€ ì˜ë„í•˜ì§€ ì•Šì€ í–‰ë™ì„ ìˆ˜í–‰í•˜ë„ë¡ ìœ ë„í•˜ëŠ” ê³µê²©
- ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìê°€ ì€í–‰ ì›¹ì‚¬ì´íŠ¸ì— ë¡œê·¸ì¸í•œ ìƒíƒœì—ì„œ, ê³µê²©ìê°€ ì œì‘í•œ ì•…ì„± ì›¹ì‚¬ì´íŠ¸ë¥¼ ì—´ë©´ ê·¸ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì€í–‰ì— ëˆì„ ì´ì²´í•˜ëŠ” ìš”ì²­ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³ , ì´ë¥¼ ì€í–‰ ì›¹ì‚¬ì´íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° ì‚¬ìš©ìëŠ” ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì€í–‰ì€ í•´ë‹¹ ìš”ì²­ì„ ì •ìƒì ì¸ ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê²Œ ëœë‹¤.

###### Spring Securityì—ì„œì˜ CSRF

- Spring Securityì—ì„œ CSRF ê³µê²©ì„ ë§‰ê¸° ìœ„í•´ ê¸°ë³¸ì ìœ¼ë¡œ CSRF í† í°ì„ ì‚¬ìš©
- ì´ í† í°ì€ ì‚¬ìš©ìì˜ ì„¸ì…˜ê³¼ ê´€ë ¨ì´ ìˆìœ¼ë©°, ë§¤ ìš”ì²­ë§ˆë‹¤ ì´ í† í°ì„ í™•ì¸í•˜ì—¬ ìš”ì²­ì˜ ìœ íš¨ì„±ì„ ê²€ì¦

-` http.csrf().disable()`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì´ CSRF ë³´í˜¸ë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ë¶€ë¶„
- ì£¼ë¡œ RESTful API ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ë©°, API ì„œë¹„ìŠ¤ëŠ” ì£¼ë¡œ statelessí•˜ê²Œ ë™ì‘í•˜ë¯€ë¡œ CSRF í† í°ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ë‹¤. 
- Statefulí•œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” CSRF í† í°ì„ ì‚¬ìš©í•˜ì—¬ ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆë‹¤.

#### âœ” 3. ì¸ì¦ Provider ë˜ëŠ” UserDetailsService êµ¬í˜„

> UserDetailsServiceëŠ” ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ë¡œë“œí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë©°, êµ¬í˜„ì²´ëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ì§€ ì •ì˜í•´ì•¼ í•œë‹¤. ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ì—ì„œ loadUserByUsername ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ì—¬ ì‹¤ì œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¡œë“œí•œë‹¤.

```java
@Service
public class CustomUserDetailsService implements UserDetailsService {
    // ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ ë˜ëŠ” ë‹¤ë¥¸ ì†ŒìŠ¤ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ì„ êµ¬í˜„
}
```

`UserDetailsService` : ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì •ì˜ëœ ë©”ì„œë“œ ì¤‘ í•˜ë‚˜. ì‚¬ìš©ìì˜ ì´ë¦„(ì¼ë°˜ì ìœ¼ë¡œëŠ” ì‚¬ìš©ì ì•„ì´ë””)ì„ ë°›ì•„ì„œ í•´ë‹¹ ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ ë¡œë“œí•˜ëŠ” ì—­í• 

- ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°, `loadUserByUsername` ë©”ì„œë“œëŠ” ì£¼ì–´ì§„ ì‚¬ìš©ì ì´ë¦„(ì•„ì´ë””)ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³ , ê·¸ ì •ë³´ë¥¼ `UserDetails` ê°ì²´ë¡œ ë°˜í™˜í•œë‹¤.
-  ë°˜í™˜ëœ `UserDetails` ê°ì²´ëŠ” Spring Securityì—ì„œ ì‚¬ìš©ìì˜ ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ì— í™œìš©ëœë‹¤.

```java
@Service
public class CustomUserDetailsService implements UserDetailsService {

    @Autowired
    private UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("User not found with username: " + username));

        return new org.springframework.security.core.userdetails.User(
                user.getUsername(),
                user.getPassword(),
                getAuthorities(user.getRoles())
        );
    }

    private Collection<? extends GrantedAuthority> getAuthorities(Set<Role> roles) {
        return roles.stream()
                .map(role -> new SimpleGrantedAuthority(role.getName()))
                .collect(Collectors.toList());
    }
}

```


# ğŸŒJWT

- JWTëŠ” í† í°ì˜ í˜•ì‹ ì¤‘ í•˜ë‚˜ë¡œ, JSON í˜•íƒœë¡œ ì¸ì½”ë”©ëœ í† í°ì´ë‹¤.
- ì£¼ë¡œ ì¸ì¦ì„ ìœ„í•´ ì‚¬ìš©ë˜ë©°, í´ë ˆì„(claim)ì´ë¼ëŠ” ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤.
- JWTëŠ” ìê°€ ìˆ˜ìš©ì (self-contained)ì´ê¸° ë•Œë¬¸ì— ì¶”ê°€ ì €ì¥ì†Œ ì—†ì´ë„ ì •ë³´ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤. JSON ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ í† í° ìì²´ì— ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ” Web Tokenì´ë‹¤.
- RFC 7519 ì›¹ í‘œì¤€ìœ¼ë¡œ ì§€ì •ë˜ì–´ ìˆë‹¤.
- í—¤ë¹„í•˜ì§€ ì•Šê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
- Cookie & Sessionì€ ì„œë²„ì˜ ì–´ë– í•œ ì €ì¥ì†Œì— í•´ë‹¹ ê°’ê³¼ ë§¤ì¹­ë˜ëŠ” valueë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í•œë‹¤. ê·¸ë˜ì„œ ì„œë²„ ìì›ì´ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë‹¨ì ì´ ìˆë‹¤.
- JWTëŠ” Cookie & Sessionì˜ ìì› ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ì´ë‹¤. JWTëŠ” í† í° ìì²´ì— ìœ ì € ì •ë³´ë¥¼ ë‹´ì•„ì„œ ì•”í˜¸í™”í•œ í† í°ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ì•”í˜¸í™”ëœ ë‚´ìš©ì€ ë””ì½”ë”© ê³¼ì •ì„ í†µí•´ì„œ í•´ì„ì´ ê°€ëŠ¥í•˜ë‹¤.

## JWTì˜ êµ¬ì„±
![](https://velog.velcdn.com/images%2Fjkijki12%2Fpost%2Ff0b2592b-c9ad-4529-872f-2575724810e3%2Fimage.png)
- **Header** : Signatureë¥¼ í•´ì‹±í•˜ê¸° ìœ„í•œ ì•Œê³ ë¦¬ì¦˜ ì •ë³´ê°€ ë‹´ê²¨ ìˆë‹¤. `Header`, `Payload`, `Verify Signature`ë¥¼ ì•”í˜¸í™”í•  ë°©ì‹(Application Layer Gateway)ê³¼ íƒ€ì… í¬í•¨.
- **Payload** : ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì£¼ê³  ë°›ëŠ” ì‹œìŠ¤í…œì—ì„œ ì‹¤ì œë¡œ ì‚¬ìš©ë  ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤. í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì •ë³´, ê¶Œí•œ ë“±ì´ í¬í•¨(userì˜ id, ìœ íš¨ê¸°ê°„ í¬í•¨)
- **Signature** : í† í°ì˜ ìœ íš¨ì„± ê²€ì¦ì„ ìœ„í•œ ë¬¸ìì—´. ì´ ë¬¸ìì—´ì„ í†µí•´ ì„œë²„ì—ì„œëŠ” ì´ í† í°ì´ ìœ íš¨í•œ í† í°ì¸ì§€ ê²€ì¦í•  ìˆ˜ ìˆë‹¤. Base64 ë°©ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œ `Header`, `Payload`, `Secret Key`ë¥¼ ë”í•œ ê°’. 

### JWTë¥¼ í†µí•œ ì¸ì¦ì ˆì°¨
1. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ í•œë‹¤.
2. ì„œë²„ì—ì„œëŠ” ê³„ì • ì •ë³´ë¥¼ ì½ì–´ ì‚¬ìš©ì í™•ì¸ í›„, ì‚¬ìš©ìì˜ ê³ ìœ IDê°’ì„ ë¶€ì—¬í•˜ê³  ê¸°íƒ€ ì •ë³´ì™€ í•¨ê»˜ `Payload`ì— ì§‘ì–´ë„£ëŠ”ë‹¤.
3. JWT í† í°ì˜ ìœ íš¨ê¸°ê°„ì„ ì„¤ì •í•œë‹¤.
4. ì•”í˜¸í™”í•  Secret keyë¥¼ ì´ìš©í•´ `Access Token`ì„ ë°œê¸‰í•œë‹¤.
5. ì‚¬ìš©ìëŠ” `Access Token`ì„ ë°›ì•„ ì €ì¥ í›„, ì¸ì¦ì´ í•„ìš”í•œ ìš”ì²­ë§ˆë‹¤ í† í°ì„ í—¤ë”ì— ì‹¤ì–´ ë³´ë‚¸ë‹¤.
6. ì„œë²„ì—ì„œëŠ” í•´ë‹¹ í† í°ì˜ `Verify Signature`ë¥¼ secret keyë¡œ ë³µí˜¸í™”í•œ í›„, ì¡°ì‘ì—¬ë¶€, ìœ íš¨ê¸°ê°„ì„ í™•ì¸í•œë‹¤.
7. ê²€ì¦ì´ ì™„ë£Œë˜ì—ˆì„ ê²½ìš° `Payload`ë¥¼ ë””ì½”ë”©í•˜ì—¬ ì‚¬ìš©ìì˜ IDì— ë§ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

> JWTëŠ” ë³´í†µ Access Tokenì˜ ìœ íš¨ê¸°ê°„ì€ ë§¤ìš° ì§§ë‹¤. ì´ìœ ëŠ” ë³´ì•ˆ ë¬¸ì œ ë•Œë¬¸ì´ë‹¤. ê·¸ë˜ì„œ Refresh Tokenì„ ë”°ë¡œ ë°œê¸‰í•´ì£¼ëŠ”ë°, Access Tokenì´ ë§Œë£Œë˜ë©´ ìƒˆë¡œìš´ JWTë¥¼ ë°œê¸‰í•  ìˆ˜ ìˆëŠ” í† í°ì´ë‹¤.

### Access Token

> JWTëŠ” Access Tokenì˜ í•œ ì¢…ë¥˜ë‹¤. OAuth 2.0 í”„ë¡œí† ì½œì—ì„œëŠ” JWTë§ê³ ë„ ë‹¤ì–‘í•œ í† í° í˜•ì‹ì„ ì§€ì›í•œë‹¤.

- ì •ì˜ : ì¼ë°˜ì ìœ¼ë¡œ OAuth 2.0 í”„ë¡œí† ì½œì—ì„œ ì‚¬ìš©ë˜ëŠ” í† í°ìœ¼ë¡œ, í´ë¼ì´ì–¸íŠ¸ê°€ ìì› ì„œë²„ì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì¸ì¦ ì •ë³´

- íŠ¹ì§•: Access Tokenì˜ í˜•ì‹ì€ OAuth 2.0 í”„ë¡œí† ì½œì— ì˜í•´ ì •ì˜ë˜ì–´ ìˆì§€ë§Œ, ê·¸ í˜•ì‹ì€ ëª…í™•í•˜ê²Œ ê·œì •ë˜ì–´ ìˆì§€ ì•Šë‹¤. OAuth 2.0ì—ì„œëŠ” í† í°ì˜ í˜•ì‹ì„ ëª…ì‹œí•˜ì§€ ì•Šê³ , ê°ê°ì˜ ì„œë¹„ìŠ¤ ë˜ëŠ” ì¸ì¦ ì„œë²„ì—ì„œ ë…ìì ìœ¼ë¡œ ì •ì˜í•œë‹¤.

#### Access Tokenì„ ì´ìš©í•œ ì¸ì¦ í”„ë¡œì„¸ìŠ¤

```mermaid
sequenceDiagram
    participant User
    participant Client
    participant AuthorizationServer
    participant ResourceServer

    User->>Client: ë¡œê·¸ì¸ ìš”ì²­
    Client->>User: ë¡œê·¸ì¸ í˜ì´ì§€ ì œê³µ
    User->>Client: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì •ë³´ ì œê³µ
    Client->>AuthorizationServer: ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì „ì†¡ (e.g., ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸)
    AuthorizationServer-->>AuthorizationServer: ì‚¬ìš©ì í™•ì¸ ë° ì¸ê°€ ì½”ë“œ ìƒì„±
    AuthorizationServer->>Client: ì¸ê°€ ì½”ë“œ ì „ì†¡

    User->>Client: ì‚¬ìš©ìê°€ ë¦¬ë‹¤ì´ë ‰íŠ¸ëœ URIë¡œ ì´ë™
    Client->>AuthorizationServer: ë°›ì€ ì¸ê°€ ì½”ë“œì™€ í•¨ê»˜ Access Token ìš”ì²­
    AuthorizationServer-->>AuthorizationServer: ì¸ê°€ ì½”ë“œ ê²€ì¦ ë° Access Token ìƒì„±
    AuthorizationServer-->>Client: Access Token ë°˜í™˜

    User->>Client: ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ìš”ì²­
    Client->>ResourceServer: Access Tokenê³¼ í•¨ê»˜ ë¦¬ì†ŒìŠ¤ ìš”ì²­
    ResourceServer-->>ResourceServer: Access Token ê²€ì¦
    ResourceServer-->>Client: ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ë°˜í™˜
```

###### 1. ë¡œê·¸ì¸ ìš”ì²­ ë° ì‚¬ìš©ì ì¸ì¦

- ì‚¬ìš©ìëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¡œê·¸ì¸ì„ ìš”ì²­í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì œê³µí•œë‹¤.
- ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” Authorization Serverì— ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ì „ì†¡í•˜ì—¬ ì‚¬ìš©ìë¥¼ í™•ì¸í•˜ê³  ì¸ê°€ ì½”ë“œë¥¼ ìƒì„±í•œë‹¤.

###### 2. Access Token ìš”ì²­ ë° ë°œê¸‰

- ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•œ í›„ í´ë¼ì´ì–¸íŠ¸ê°€ Authorization Serverì—ê²Œ ì¸ê°€ ì½”ë“œë¥¼ ì´ìš©í•´ Access Tokenì„ ìš”ì²­í•œë‹¤.
- Authorization ServerëŠ” ì¸ê°€ ì½”ë“œì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ê³ , ê²€ì¦ì´ ì„±ê³µí•˜ë©´ Access Tokenì„ ë°œê¸‰í•œë‹¤.

###### 3. ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ìš”ì²­

- ì‚¬ìš©ìê°€ ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ë ¤ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ë°œê¸‰ë°›ì€ Access Tokenì„ ì´ìš©í•˜ì—¬ Resource Serverì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•œë‹¤.
- Resource ServerëŠ” Access Tokenì„ ê²€ì¦í•˜ê³ , ìœ íš¨í•œ ê²½ìš° ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜í•œë‹¤.

#### Refresh Tokenì„ ì´ìš©í•œ ì¸ì¦ í”„ë¡œì„¸ìŠ¤

>  Refresh Tokenì„ ì´ìš©í•˜ë©´ Access Tokenì´ ë§Œë£Œë˜ì—ˆì„ ë•Œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë‹¤ì‹œ ë¡œê·¸ì¸ì„ ìš”ì²­í•˜ì§€ ì•Šê³ ë„ ìƒˆë¡œìš´ Access Tokenì„ ì–»ì„ ìˆ˜ ìˆë‹¤.

```mermaid
sequenceDiagram
    participant User
    participant Client
    participant AuthorizationServer
    participant ResourceServer

    User->>Client: ë¡œê·¸ì¸ ìš”ì²­
    Client->>User: ë¡œê·¸ì¸ í˜ì´ì§€ ì œê³µ
    User->>Client: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì •ë³´ ì œê³µ
    Client->>AuthorizationServer: ì‚¬ìš©ì ì¸ì¦ ë° ì¸ê°€ ìš”ì²­
    AuthorizationServer-->>AuthorizationServer: ì‚¬ìš©ì í™•ì¸ ë° Access Token, Refresh Token ìƒì„±
    AuthorizationServer-->>Client: Access Token, Refresh Token ë°˜í™˜

    User->>Client: ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ìš”ì²­ (Access Token í¬í•¨)
    Client->>ResourceServer: Access Tokenê³¼ í•¨ê»˜ ë¦¬ì†ŒìŠ¤ ìš”ì²­
    ResourceServer-->>ResourceServer: Access Token ê²€ì¦
    ResourceServer-->>Client: ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ë°˜í™˜

    loop Access Token ë§Œë£Œ
        User->>Client: ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ìš”ì²­ (Access Token ë§Œë£Œ)
        Client->>AuthorizationServer: Refresh Tokenì„ ì´ìš©í•œ í† í° ì¬ë°œê¸‰ ìš”ì²­
        AuthorizationServer-->>AuthorizationServer: Refresh Token ê²€ì¦ ë° ìƒˆë¡œìš´ Access Token, Refresh Token ìƒì„±
        AuthorizationServer-->>Client: ìƒˆë¡œìš´ Access Token, Refresh Token ë°˜í™˜
    end
```

###### 1. ë¡œê·¸ì¸ ë° Access Token, Refresh Token ë°œê¸‰
   - ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ ìš”ì²­í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì œê³µí•œë‹¤.
   - ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì œê³µí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” Authorization Serverì— ì‚¬ìš©ì ì¸ì¦ ë° ì¸ê°€ ìš”ì²­ì„ í•˜ê³ , Authorization ServerëŠ” Access Tokenê³¼ Refresh Tokenì„ ë°œê¸‰í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜í•œë‹¤.

###### 2. ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ ìš”ì²­ ë° Access Token ê°±ì‹ 
   - ì‚¬ìš©ìê°€ ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ë•Œ í´ë¼ì´ì–¸íŠ¸ëŠ” ë°œê¸‰ë°›ì€ Access Tokenì„ ì‚¬ìš©í•˜ì—¬ Resource Serverì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•œë‹¤.
   - ë§Œì•½ Access Tokenì´ ë§Œë£Œë˜ì—ˆë‹¤ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” Refresh Tokenì„ ì´ìš©í•˜ì—¬ Authorization Serverì—ê²Œ ìƒˆë¡œìš´ Access Tokenì„ ìš”ì²­í•˜ê³ , Authorization ServerëŠ” ìƒˆë¡œìš´ Access Tokenê³¼ í•¨ê»˜ Refresh Tokenì„ ë°˜í™˜í•œë‹¤.


#### JWTì˜ ì¥ì 
- ì¤‘ì•™ì˜ ì¸ì¦ì„œë²„, ë°ì´í„° ìŠ¤í† ì–´ì— ëŒ€í•œ ì˜ì¡´ì„±ì´ ì—†ë‹¤.
- ì‹œìŠ¤í…œ ìˆ˜í‰ì  í™•ì¥ì— ìœ ë¦¬í•˜ë‹¤.
- Base64 URL Safe Encoding > URL, Cookie, Header ëª¨ë‘ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.
  - `Base64`ë€? 8ë¹„íŠ¸ ì´ì§„ ë°ì´í„°(ì‹¤í–‰íŒŒì¼, zipíŒŒì¼ ë“±)ë¥¼ ë¬¸ì ì½”ë“œì— ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ê³µí†µ ASCIIì˜ì—­ì˜ ë¬¸ìë“¤ë¡œë§Œ ì´ë£¨ì–´ì§„ ë¬¸ìì—´ë¡œ ë°”ê¾¸ëŠ” ì¸ì½”ë”© ë°©ì‹.  ASCII ë¬¸ì í•˜ë‚˜ê°€ 64ì§„ë²•ì˜ ìˆ«ì í•˜ë‚˜ë¥¼ ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì— BASE64ë¼ëŠ” ì´ë¦„ì„ ê°€ì¡Œë‹¤.

#### JWTì˜ ë‹¨ì 
- Payloadì˜ ì •ë³´ê°€ ë§ì•„ì§€ë©´ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•œë‹¤. 
- ë°ì´í„° ì„¤ê³„ë¥¼ ê³ ë ¤í•  í•„ìš”ê°€ ìˆë‹¤.
- í† í°ì´ í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥ëœë‹¤. ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ í† í°ì„ ì¡°ì‘í•  ìˆ˜ ì—†ë‹¤.

# ğŸ“Œ Spring Securityì™€ JWTë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´

##### âœ” 1. Spring securityì™€ jwtê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ build.gradleì— ì¶”ê°€
##### âœ” 2. securityì™€ filter ê´€ë ¨ ì„¤ì • í•˜ê¸°


```java
@RequiredArgsConstructor
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    private final JwtTokenProvider jwtTokenProvider;

    // authenticationManagerë¥¼ Bean ë“±ë¡í•©ë‹ˆë‹¤.
    @Bean
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        return super.authenticationManagerBean();
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {

        http.csrf().disable();
        //http.httpBasic().disable(); // ì¼ë°˜ì ì¸ ë£¨íŠ¸ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ìš”ì²­ì‹œ ê±°ì ˆ, headerì— id, pwê°€ ì•„ë‹Œ token(jwt)ì„ ë‹¬ê³  ê°„ë‹¤. ê·¸ë˜ì„œ basicì´ ì•„ë‹Œ bearerë¥¼ ì‚¬ìš©
        http.httpBasic().disable()
                .authorizeRequests()// ìš”ì²­ì— ëŒ€í•œ ì‚¬ìš©ê¶Œí•œ ì²´í¬
                .antMatchers("/test").authenticated()
                .antMatchers("/admin/**").hasRole("ADMIN")
                .antMatchers("/user/**").hasRole("USER")
                .antMatchers("/**").permitAll()
                .and()
                .addFilterBefore(new JwtAuthenticationFilter(jwtTokenProvider),
                        UsernamePasswordAuthenticationFilter.class); // JwtAuthenticationFilterë¥¼ UsernamePasswordAuthenticationFilter ì „ì— ë„£ëŠ”ë‹¤
        // + í† í°ì— ì €ì¥ëœ ìœ ì €ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ì•¼ í•˜ê¸° ë•Œë¬¸ì— CustomUserDetailService í´ë˜ìŠ¤ë¥¼ ìƒì„±
        http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);
    }
}
```
(1) `AuthenticationManager`ë¥¼ Beanìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.  
(2) ì„¤ì •í•´ì•¼ í•  ëª©ë¡  
- `antMatchers()` : í•´ë‹¹ URLë¡œ ìš”ì²­ ì‹œ ì„¤ì •ì„ í•´ì¤€ë‹¤.
- `authenticated()` : `andMatchers`ì— ì†í•´ìˆëŠ” URLë¡œ ìš”ì²­ì´ ì˜¤ë©´ ì¸ì¦ì´ í•„ìš”í•˜ë‹¤ê³  ì„¤ì •í•œë‹¤.
- `hasRole()` : `andMatchers`ì— ì†í•´ìˆëŠ” URLë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ê¶Œí•œì„ í™•ì¸í•œë‹¤.  
(3) `addFilterBefore()` : í•„í„°ë¥¼ ë“±ë¡í•œë‹¤. ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•„í„°ë§ì— ë“±ë¡í•´ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ì—¬ê¸°ì— ë“±ë¡í•´ì£¼ì–´ì•¼ í•œë‹¤. íŒŒë¼ë¯¸í„°ëŠ” 2ê°€ì§€ê°€ ë“¤ì–´ê°„ë‹¤. ì™¼ìª½ì€ ì»¤ìŠ¤í…€í•œ í•„í„°ë§ì´ ë“¤ì–´ê°„ë‹¤. ì˜¤ë¥¸ìª½ì— ë“±ë¡í•œ í•„í„°ì „ì— ì»¤ìŠ¤í…€í•„í„°ë§ì´ ìˆ˜í–‰ëœë‹¤.  
(4) `http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)` : ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ì„¤ì •í•œë‹¤.  


##### âœ” 3. Custom Filter êµ¬í˜„í•˜ê¸°

```java
//í•´ë‹¹ í´ë˜ìŠ¤ëŠ” JwtTokenProviderê°€ ê²€ì¦ì„ ëë‚¸ Jwtë¡œë¶€í„° ìœ ì € ì •ë³´ë¥¼ ì¡°íšŒí•´ì™€ì„œ UserPasswordAuthenticationFilter ë¡œ ì „ë‹¬
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends GenericFilterBean {

    private final JwtTokenProvider jwtTokenProvider;

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        // í—¤ë”ì—ì„œ JWT ë¥¼ ë°›ì•„ì˜´
        String token = jwtTokenProvider.resolveToken((HttpServletRequest) request);
        // ìœ íš¨í•œ í† í°ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
        if (token != null && jwtTokenProvider.validateToken(token)) {
            // í† í°ì´ ìœ íš¨í•˜ë©´ í† í°ìœ¼ë¡œë¶€í„° ìœ ì € ì •ë³´ë¥¼ ë°›ì•„ì˜´
            Authentication authentication = jwtTokenProvider.getAuthentication(token);
            // SecurityContext ì— Authentication ê°ì²´ë¥¼ ì €ì¥
            SecurityContextHolder.getContext().setAuthentication(authentication);
        }
        chain.doFilter(request, response);
    }
}
```

##### âœ” 4. Custom Provider êµ¬í˜„í•˜ê¸°

- Custom Authentication Providerë¥¼ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ì‚¬ìš©ìì˜ ì¸ì¦ ë¡œì§ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ëŠ”ë° ìœ ìš©í•˜ë‹¤. - Custom Authentication ProviderëŠ” ê¸°ì¡´ì˜ ì‚¬ìš©ì ì¸ì¦ ë¡œì§ì„ ëŒ€ì²´í•˜ê³ , íŠ¹ì • ì¸ì¦ ë°©ì‹ì„ ì²˜ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.


**Custom Authentication Provider**


- AuthenticationProviderë¥¼ êµ¬í˜„í•˜ì—¬ JWTë¥¼ ì²˜ë¦¬í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ í”„ë¡œë°”ì´ë”
- JwtAuthenticationTokenê³¼ JwtUserDetails í´ë˜ìŠ¤ë¥¼ ì ì ˆíˆ êµ¬í˜„í•˜ì—¬ í† í°ì„ ì²˜ë¦¬í•˜ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤. 
- ì´ë¥¼ Spring Security ì„¤ì •ì—ì„œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

```java
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.AuthenticationException;

public class JwtAuthenticationProvider implements AuthenticationProvider {

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        JwtAuthenticationToken jwtAuthenticationToken = (JwtAuthenticationToken) authentication;
        String token = jwtAuthenticationToken.getToken();

        // JWT ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ë¡œì§ì„ êµ¬í˜„

        // ì‚¬ìš©ì ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Authentication ê°ì²´ ìƒì„±
        JwtUserDetails userDetails = buildUserDetailsFromToken(token);
        return new JwtAuthenticationToken(userDetails, token, userDetails.getAuthorities());
    }

    @Override
    public boolean supports(Class<?> authentication) {
        return JwtAuthenticationToken.class.isAssignableFrom(authentication);
    }

    private JwtUserDetails buildUserDetailsFromToken(String token) {
        // JWTì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ UserDetails ê°ì²´ ìƒì„±
        // (ì˜ˆ: í† í° ë””ì½”ë”©, ì‚¬ìš©ì ì •ë³´ ì½ê¸°)
        // ...

        return new JwtUserDetails(username, authorities);
    }
}
```

**JwtAuthenticationToken ë° UserDetails êµ¬í˜„**

```java
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.GrantedAuthority;

import java.util.Collection;

public class JwtAuthenticationToken extends UsernamePasswordAuthenticationToken {

    private String token;

    public JwtAuthenticationToken(Object principal, Object credentials) {
        super(principal, credentials);
    }

    // ìƒì„±ì, getter, setter ë“± í•„ìš”í•œ ë©”ì„œë“œ êµ¬í˜„

    public String getToken() {
        return token;
    }
}

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.User;

import java.util.Collection;

public class JwtUserDetails extends User {

    public JwtUserDetails(String username, Collection<? extends GrantedAuthority> authorities) {
        super(username, "", authorities);
    }
}
```

**Spring Security ì„¤ì •ì— Custom Provider ë“±ë¡**

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Bean
    public AuthenticationProvider authenticationProvider() {
        return new JwtAuthenticationProvider();
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.authenticationProvider(authenticationProvider());
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        // ë‹¤ë¥¸ ë³´ì•ˆ ì„¤ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŒ
    }
}
```

###### reference

> [Cross Site Request Forgery (CSRF)](https://docs.spring.io/spring-security/reference/features/exploits/csrf.html)
> [ëª¨ë‘ë¥¼ ìœ„í•œ JWT](https://velog.io/@jeonjay/%EB%AA%A8%EB%91%90%EB%A5%BC-%EC%9C%84%ED%95%9C-JWT)
> [Spring boot - security-jwt ì—°ë™ê³¼ íë¦„(feat.AccessToken, RefreshToken)](https://kdg-is.tistory.com/228)  
> [Spirng Security + Jwt ë¡œê·¸ì¸ ì ìš©í•˜ê¸°](https://velog.io/@jkijki12/Spirng-Security-Jwt-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0)  
> [ë² ì´ìŠ¤64](https://ko.wikipedia.org/wiki/%EB%B2%A0%EC%9D%B4%EC%8A%A464#cite_ref-2)  
> [spring security íŒŒí—¤ì¹˜ê¸° (êµ¬ì¡°, ì¸ì¦ê³¼ì •, ì„¤ì •, í•¸ë“¤ëŸ¬ ë° ì•”í˜¸í™” ì˜ˆì œ, @Secured, @AuthenticationPrincipal, taglib)](https://sjh836.tistory.com/165)
> [Spring Security, ì œëŒ€ë¡œ ì´í•´í•˜ê¸° - FilterChain](https://gngsn.tistory.com/160)
