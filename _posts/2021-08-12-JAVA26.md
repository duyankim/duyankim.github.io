---
layout: post
author: "Yan"
catalog: true
subtitle: "Java Garbage Collection"
header-img: "img/header/java.jpg"
title: "Java - ê°€ë¹„ì§€ ì»¬ë ‰ì…˜"
date: 2021-08-12 11:40:08 +0000
categories:
  - Java
tags:
  - Garbage_Collection
  - Collection
  - java
comments: true
---

# Generation Garbage Collection

## ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì´ë€?

- ë™ì ìœ¼ë¡œ í• ë‹¹í•œ ë©”ëª¨ë¦¬ ì˜ì—­ ì¤‘ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì˜ì—­ì„ íƒì§€í•˜ì—¬ í•´ì œí•˜ëŠ” ê¸°ëŠ¥
- Javaì—ì„œ ê°œë°œìê°€ í”„ë¡œê·¸ë¨ ì½”ë“œë¡œ ë©”ëª¨ë¦¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í•´ì œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ëŠ” ë” ì´ìƒ í•„ìš” ì—†ëŠ” ê°ì²´ë¥¼ ì°¾ì•„ì„œ ì§€ìš°ëŠ” ì—­í• ì„ í•œë‹¤.

> ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ ì˜ì—­ == Heap
> ëª¨ë“  Objectíƒ€ì…ì˜ ë°ì´í„° í• ë‹¹
> Heap ì˜ì—­ì˜ Objectë¥¼ ê°€ë¦¬í‚¤ëŠ” ì°¸ì¡°ë³€ìˆ˜ê°€ Stackì— í• ë‹¹
---
> ì •ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ ì˜ì—­ == Stack
> ì›ì‹œ íƒ€ì…ì˜ ë°ì´í„°ê°€ ê°’ê³¼ í•¨ê»˜ í• ë‹¹
> Heap ì˜ì—­ì— ìƒì„±ëœ Object íƒ€ì…ì˜ ë°ì´í„° ì°¸ì¡° ê°’ í• ë‹¹

### Garbage Collectorì˜ ë™ì‘ ê³¼ì •

1. Garbage Collectorê°€ Stackì˜ ëª¨ë“  ë³€ìˆ˜ë¥¼ ìŠ¤ìº”í•˜ë©´ì„œ ê°ê° ì–´ë–¤ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ”ì§€ ì°¾ì•„ì„œ ë§ˆí‚¹í•œë‹¤. `Mark`
2. Reachable Objectê°€ ì°¸ì¡°í•˜ê³  ìˆëŠ” ê°ì²´ë„ ì°¾ì•„ì„œ ë§ˆí‚¹í•œë‹¤. `Mark`
3. ë§ˆí‚¹ë˜ì§€ ì•Šì€ ê°ì²´ë¥¼ Heapì—ì„œ ì œê±°í•œë‹¤. `Sweep`

### ê°€ì„¤(ì „ì œì¡°ê±´) `Weak generation hypothesis`

- ëŒ€ë¶€ë¶„ì˜ ê°ì²´ëŠ” ê¸ˆë°© ì ‘ê·¼ ë¶ˆê°€ëŠ¥`unreachable` ìƒíƒœê°€ ëœë‹¤.
- ì˜¤ë˜ëœ ê°ì²´ì—ì„œ ì Šì€ ê°ì²´ë¡œì˜ ì°¸ì¡°ëŠ” ì•„ì£¼ ì ê²Œ ì¡´ì¬í•œë‹¤.

#### ì´ ê°€ì„¤ì˜ ì¥ì ì„ ìµœëŒ€í•œ ì‚´ë¦¬ê¸° ìœ„í•´ì„œ

HotSpot VMì—ì„œëŠ” ë¬¼ë¦¬ì  ê³µê°„ì„ í¬ê²Œ 2ê°œë¡œ ë‚˜ëˆˆë‹¤.

1. `Young Generation ì˜ì—­`
    - ìƒˆë¡­ê²Œ ìƒì„±í•œ ê°ì²´ì˜ ëŒ€ë¶€ë¶„ì´ ìœ„ì¹˜í•˜ëŠ” ê³³
    - ëŒ€ë¶€ë¶„ì˜ ê°ì²´ê°€ ê¸ˆë°© ì ‘ê·¼ ë¶ˆê°€ëŠ¥ ìƒíƒœê°€ ë˜ê¸° ë•Œë¬¸ì— ë§ì€ ê°ì²´ê°€ Youngì˜ì—­ì— ìƒì„±ë˜ì—ˆë‹¤ê°€ ì‚¬ë¼ì§„ë‹¤.
    - ê°ì²´ê°€ ì‚¬ë¼ì§ˆ ë•Œ Minor GCê°€ ë°œìƒí•œë‹¤ê³  ë§í•œë‹¤.

2. `Old Generation ì˜ì—­`
    - ì ‘ê·¼ ë¶ˆê°€ëŠ¥ ìƒíƒœë¡œ ë˜ì§€ ì•Šì•„ Youngì˜ì—­ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ê°€ ì—¬ê¸°ë¡œ ë³µì‚¬ëœë‹¤.
    - ëŒ€ë¶€ë¶„ Youngì˜ì—­ë³´ë‹¤ í¬ê²Œ í• ë‹¹í•œë‹¤. í¬ê¸°ê°€ í°ë§Œí¼ Youngì˜ì—­ë³´ë‹¤ GCê°€ ë²…ê²Œ ë°œìƒí•œë‹¤.
    - ê°ì²´ê°€ ì‚¬ë¼ì§ˆ ë•Œ Major GCê°€ ë°œìƒí•œë‹¤ê³  ë§í•œë‹¤.

![](https://d2.naver.com/content/images/2015/06/helloworld-1329-1.png)
- Permanent Generation ì˜ì—­ì€ Method Areaë¼ê³ ë„ í•œë‹¤.
- ê°ì²´ë‚˜ ì–µë¥˜ëœ ë¬¸ìì—´ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê³³
- Oldì˜ì—­ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ê°€ ì˜ì›íˆ ë‚¨ì•„ ìˆëŠ” ê³³ì€ ì•„ë‹ˆë‹¤.
- ì´ ì˜ì—­ì—ì„œ GCê°€ ë°œìƒí•´ë„ Major GCì˜ íšŸìˆ˜ì— í¬í•¨ëœë‹¤.
  
##### Oldì˜ì—­ì˜ ê°ì²´ê°€ Youngì˜ì—­ì˜ ê°ì²´ë¥¼ ì°¸ì¡°í•œë‹¤ë©´?

- Oldì˜ì—­ì—ëŠ” 512byteì˜ chunkë¡œ ë˜ì–´ìˆëŠ” card tableì´ ìˆëŠ”ë°, ì¹´ë“œí…Œì´ë¸”ì—ëŠ” Oldì˜ì—­ ê°ì²´ê°€ Youngì˜ì—­ ê°ì²´ë¥¼ ì°¸ì¡°í•  ë•Œë§ˆë‹¤ ì •ë³´ê°€ í‘œì‹œëœë‹¤. 
- Youngì˜ì—­ì˜ GCë¥¼ ì‹¤í–‰í•  ë•Œ Oldì˜ì—­ì— ìˆëŠ” ëª¨ë“  ê°ì²´ì˜ ì°¸ì¡°ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³ , ì´ ì¹´ë“œ í…Œì´ë¸”ë§Œ ë’¤ì ¸ì„œ GC ëŒ€ìƒì¸ì§€ ì‹ë³„í•œë‹¤.
- ì¹´ë“œí…Œì´ë¸”ì€ write barrierë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬í•œë‹¤. 

---

## ë™ì‘ ë°©ì‹

1. Stop the world
2. Mark and Sweep

### Stop the world

`stop-the-world` : GCë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ JVMì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì„ ë©ˆì¶”ëŠ” ê²ƒ. 
    - ì‹¤í–‰ì‹œ ì“°ë ˆë“œë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì“°ë ˆë“œëŠ” ëª¨ë‘ ì‘ì—…ì„ ë©ˆì¶˜ë‹¤. 
    - GCì‘ì—…ì´ ëë‚˜ë©´ ì¤‘ë‹¨í–ˆë˜ ì‘ì—…ì„ ë‹¤ì‹œ ì‹œì‘í•œë‹¤. 
    - ëª¨ë“  GCì•Œê³ ë¦¬ì¦˜ì€ `stop-the-world`ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

### Mark and Sweep

`Mark` : ì‚¬ìš©ë˜ëŠ” ë©”ëª¨ë¦¬ì™€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ë¥¼ ì‹ë³„í•˜ëŠ” ì‘ì—…  
    - `stop-the-world`ë¡œ ëª¨ë“  ì‘ì—…ì„ ì¤‘ë‹¨ì‹œí‚¤ë©´, GCëŠ” ìŠ¤íƒì˜ ëª¨ë“  ë³€ìˆ˜ë‚˜ Reachable ê°ì²´ë¥¼ ìŠ¤ìº”í•˜ë©´ì„œ ê°ê° ì–´ë–¤ ê°ì²´ë¥¼ ì°¸ê³ í•˜ê³  ì‡ëŠ”ì§€ íƒìƒ‰í•œë‹¤. ê·¸ëŸ¬ë©´ì„œ ì‚¬ìš©ë˜ê³  ìˆëŠ” ë©”ëª¨ë¦¬ë¥¼ ì‹ë³„í•˜ëŠ” ê³¼ì •ì„ `Mark`ë¼ í•œë‹¤  

`Sweep` : Mark ë‹¨ê³„ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  ë¶„ë¥˜ëœ ë©”ëª¨ë¦¬ë¥¼ í•´ì œí•˜ëŠ” ì‘ì—…
    - `Mark`ê°€ ë˜ì§€ ì•Šì€ ê°ì²´ë“¤ì„ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°í•˜ëŠ” ê³¼ì •


## Youngì˜ì—­ì˜ êµ¬ì„±

- Youngì˜ì—­ì€ ê°ì²´ê°€ ì œì¼ ë¨¼ì € ìƒì„±ë˜ëŠ” ê³³ì´ë‹¤.
- `Edenì˜ì—­` / `Survivorì˜ì—­`(2ê°œ)ë¡œ ì´ë£¨ì–´ì§„ë‹¤.

### ì²˜ë¦¬ ì ˆì°¨

- `Eden` : ìƒˆë¡œ ìƒì„±í•œ ëŒ€ë¶€ë¶„ì˜ ê°ì²´ê°€ ìƒì„±ëœ ìœ„ì¹˜
- `Eden`ì—ì„œ GCê°€ í•œë²ˆ ë°œìƒí•œ í›„ ì‚´ì•„ë‚¨ì€ ê°ì²´ëŠ” `Survivor`ì˜ì—­ ì¤‘ í•˜ë‚˜ë¡œ ì´ë™ëœë‹¤
- `Eden`ì—ì„œ GCê°€ ë°œìƒí•˜ë©´ ì´ë¯¸ ì‚´ì•„ë‚¨ì€ ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ” `Survivor`ì˜ì—­ìœ¼ë¡œ ê°ì²´ê°€ ê³„ì† ìŒ“ì¸ë‹¤
- í•˜ë‚˜ì˜ `Survivor`ì˜ì—­ì´ ê°€ë“ì°¨ê²Œ ë˜ë©´ ê·¸ ì¤‘ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ëŠ” ë‹¤ë¥¸ `Survivor`ì˜ì—­ìœ¼ë¡œ ì´ë™í•œë‹¤. ê°€ë“ ì°¬ `Survivor`ì˜ì—­ì€ ì•„ë¬´ ë°ì´í„°ë„ ì—†ëŠ” ìƒíƒœê°€ ëœë‹¤.
- ì´ ê³¼ì •ì„ ë°˜ë³µí•˜ë‹¤ê°€ ê³„ì†í•´ì„œ ì‚´ì•„ë‚¨ì•„ìˆëŠ” ê°ì²´ëŠ” `Old`ì˜ì—­ìœ¼ë¡œ ì´ë™í•œë‹¤
---
- `Survivor`ì˜ì—­ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ë¹„ì–´ìˆëŠ” ìƒíƒœë¡œ ë‚¨ì•„ìˆì–´ì•¼ í•œë‹¤.
- ë§Œì•½ ë‘ `Survivor`ì˜ì—­ì— ëª¨ë‘ ë°ì´í„°ê°€ ì¡´ì¬í•˜ê±°ë‚˜ ë‘ ì˜ì—­ ëª¨ë‘ ì‚¬ìš©ëŸ‰ì´ 0ì´ë©´ ì‹œìŠ¤í…œì´ ì •ìƒì ì¸ ìƒí™©ì´ ì•„ë‹ˆë¼ê³  ë³´ë©´ ëœë‹¤

## Garbage Collector ì¢…ë¥˜

1. Serial GC
- GCë¥¼ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œê°€ 1ê°œë‹¤
- CPU ì½”ì–´ê°€ 1ê°œë§Œ ìˆì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤
- Mark-Compact collection ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©

2. Parallel GC
- GCë¥¼ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œê°€ ì—¬ëŸ¬ ê°œë‹¤
- Serial GCë³´ë‹¤ ë¹ ë¥´ê²Œ ê°ì²´ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤
- ë©”ëª¨ë¦¬ê°€ ì¶©ë¶„í•˜ê³  ì½”ì–´ì˜ ê°œìˆ˜ê°€ ë§ì„ ë•Œ ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤

3. Concurrent Mark Sweep GC (CMS GC)
- `Stop the world`ë¥¼ ì¤„ì´ëŠ” GC
- `stop the world`ì‹œê°„ì´ ì§§ì•„ì„œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‘ë‹µ ì‹œê°„ì´ ë¹¨ë¼ì•¼ í•  ë•Œ ì‚¬ìš©í•œë‹¤
- ë‹¤ë¥¸ GCë°©ì‹ë³´ë‹¤ ë©”ëª¨ë¦¬ì™€ CPUë¥¼ ë” ë§ì´ ì‚¬ìš©í•œë‹¤
- Compaction ë‹¨ê³„ê°€ ì œê³µë˜ì§€ ì•ŠëŠ”ë‹¤

4. G1 GC
- ê° ì˜ì—­ì„ Region ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆˆë‹¤
- GCê°€ ì¼ì–´ë‚  ë•Œ ì „ì²´ì˜ì—­(Eden, Survival, Old generation)ì„ íƒìƒ‰í•˜ì§€ ì•ŠëŠ”ë‹¤
- ë°”ë‘‘íŒì˜ ê° ì˜ì—­ì— ê°ì²´ë¥¼ í• ë‹¹í•˜ê³  GCë¥¼ ì‹¤í–‰í•œë‹¤
- í•´ë‹¹ ì˜ì—­ì´ ê½‰ ì°¨ë©´ ë‹¤ë¥¸ ë¹ˆ ì˜ì—­ì— ê°ì²´ë¥¼ í• ë‹¹í•˜ê³  gCë¥¼ ì‹¤í–‰í•œë‹¤
- STW ì‹œê°„ì´ ì§§ë‹¤
- Compactionì„ ì‚¬ìš©í•œë‹¤

---
###### reference 
> [Java Garbage Collection](https://d2.naver.com/helloworld/1329)
> [[Java] Garbage Collection(ê°€ë¹„ì§€ ì»¬ë ‰ì…˜)ì˜ ê°œë… ë° ë™ì‘ ì›ë¦¬ (1/2)](https://mangkyu.tistory.com/118)
> [[10ë¶„ í…Œì½”í†¡] ğŸ‘Œë˜ì˜ JVMì˜ Garbage Collector](https://youtu.be/vZRmCbl871I)
